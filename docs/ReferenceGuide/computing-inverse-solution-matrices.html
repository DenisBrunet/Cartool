<HTML>
 <HEAD>

  <TITLE>Creating Inverse Solution Matrices</TITLE>

 <LINK REL="stylesheet" HREF="../cartool.css" TYPE="text/css">

  <style type="text/css">
.auto-style1 {
	margin-left: 20pt;
}
.auto-style6 {
	font-family: "Courier New";
}
.auto-style8 {
	color: #000000;
}
.auto-style5 {
	font-family: "Courier New";
	color: #000000;
}
.auto-style10 {
	color: #1155E0;
}
.fontstyle0
{
	font-family:Arial,Bold;
	font-size:16pt;
	font-style:normal;
	font-weight:bold;
	color:rgb(0,0,0);
}
.fontstyle2
{
	font-family:Arial,BoldItalic;
	font-size:16pt;
	font-style:italic;
	font-weight:bold;
	color:rgb(0,0,0);
}
.auto-style11 {
	border-style: solid;
	border-width: 1pt;
	margin-left: 20pt;
}
.auto-style12 {
	border: 1pt solid #000000;
}
</style>

 </HEAD>

 <BODY>

	<div class="container">

	<object data="../cartool-menu.html" class="menu-iframe"></object>

         <H1>
             Creating Inverse Solution Matrices
         </H1>
         <P>
             &nbsp;
         </P>
         <P>
             This page is about <B>creating the matrices</B> for solving the
             Inverse Solution (IS) problem.
         </P>
         <P>
             You can then <B><a href="esi-display.html">use these matrices for display</a></B>,
             or to <B>
                 <a href="computing-ris.html">
                     compute the results of inverse
                     solutions
                 </a>
             </B>from EEG (or frequency) files.
         </P>
         <p>
             Here is a highly recommended article about practical use of the inverse
             solutions:
         </p>
         <PRE><a href="https://www.ncbi.nlm.nih.gov/pubmed/24791748"><span class="auto-style6"><strong><span class="auto-style8">&quot;EEG Source Imaging: A Pratical Review of the Analysis Steps&quot;</span></strong><span class="auto-style8">,
</span></span></a><span class="auto-style5"><a href="https://www.ncbi.nlm.nih.gov/pubmed/24791748" class="auto-style8">C.M. Michel, D. Brunet,
<em>Front. Neurol.</em>, 04 April 2019</a></span></PRE>
         <H5>
             <A HREF="#what-is-inverse">What are Inverse Solution matrices</A><br>
             <A HREF="#running-creation">Creating the matrices</A>
         </H5>
         <UL>
             <H5>
                 <A HREF="#mris-preprocessing">MRIs preprocessing</A><br>
                 <A HREF="#electrodes-setup">Electrodes preprocessing</A><br>
                 <A HREF="#solution-space">Solution space</A><br>
                 <A HREF="#lead-field-comput">Lead Field processing</A><br>
                 <A HREF="#combining-sps-and-lf">Solution Points and Lead Field cases</A><br>
                 <A HREF="#inverse-solution">Matrix inversion</A>
             </H5>
         </UL>
         <H2>
             <A NAME="what-is-inverse"></A>What are Inverse Solution (IS) matrices
         </H2>
         <P>
             These matrices are the solutions of the so-called <B>
                 distributed
                 linear inverse problem
             </B>: recovering the <B>
                 most probable sources
                 of activity from the brain
             </B>, without any assumption to the number
             and/or locations of these sources, given only the EEG surface
             recording of these sources.
         </P>
         <P>
             Right away, it should appear that there are quite a lot of
             difficulties in this process, some of them being:
         </P>
         <UL>
             <LI CLASS="mvd-P">
                 <P>
                     we wish to retrieve <B>3D activities</B> (inside the brain) from a <B>
                         2D
                         recording
                     </B> (surface EEG), in which all signals have been summed up;
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     the recovered signal is <B>blurred</B> by the underlying tissues
                     (skull mainly), and <B>weakened</B> proportionally to distance;
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     there are <B>many physical constants</B> to account for, not all
                     being well known (f.ex. skull conductivity);
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     there are many <B>mathematical</B> and <B>computational issues</B> in
                     the process itself.
                 </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <P>
             But fear not, all these can be reasonably addressed.
         </P>
         <H3>
             <A NAME="theory"></A><em>&quot;The theory&quot;</em>
         </H3>
         <P>
             All the theory and formulas will <I>not</I> be covered here but can
             be found in the following literature:
         </P>

         <PRE>
<B>Electrical Neuroimaging</B>,<BR>Chr. Michel, Th. Koenig, D. Brandeis, L.R.R. Gianotti and J. Wackermann,<BR><I>Cambridge University Press</I>, 2009.<BR> <BR>
<B>Niedermeyer's Electroencephalography</B>, chapter 55 <B>&quot;EEG Mapping and Source Imaging&quot;</B>,<BR>Chr. Michel, B. He,<BR><I>Lippincott Williams &amp; Wilkins</I>, 2010.<BR> <BR>
<B>&quot;EEG source imaging</B>&quot;,<BR>Chr. Michel, M.M. Murray, G. Lantz, S. Gonzalez, L. Spinelli, R. Grave de Peralta,<BR><I>Clinical Neurophysiology</I>, 2004.<BR> <BR>
<B>&quot;Electromagnetic Inverse Solutions in anatomically constrained spherical head models&quot;</B>,<BR>L. Spinelli, S. Gonzalez Andino, G. Lantz, Chr. Michel,<BR><I>Brain Topography</I>, 2000.<BR> <BR>
<B>&quot;Review of methods for solving the EEG inverse problem&quot;</B>,<BR>R.D. Pascual-Marqui,<BR><I>International Journal of Bioelectromagnetism</I>, 1999.<BR> <BR>
<B>&quot;Electrical neuroimaging based on biophysical constraints&quot;</B>,<BR>R.G. de Peralta Menendez, M.M. Murray, Chr.M. Michel, R. Martuzzi, S.L. Gonzalez Andino,<BR><I>NeuroImage</I>, 2004</PRE>

         <p>
             These are also some <strong>very interesting reading here</strong> about
             the forward &amp; inverse model, clinical validation and monkey experiment:
         </p>

         <PRE>
<a href="https://www.frontiersin.org/articles/10.3389/fneur.2019.00325/full"><strong>&quot;EEG Source Imaging: A Practical Review of the Analysis Steps&quot;</strong>,<BR>C.M. Michel, D. Brunet,<BR><em>Front. Neurol.</em>, 04 April 2019</a> <BR> <BR>
<a href="https://www.ncbi.nlm.nih.gov/pubmed/25003030"><strong>&quot;Head model and electrical source imaging: A study of 38 epileptic patients&quot;</strong>,<BR>G. Birot, L. Spinelli, S. Vulli&eacute;moz, P. M&eacute;gevand, D. Brunet, M. Seeck, C.M. Michel,<BR><em>NeuroImage: Clinical</em>, 2014</a> <BR> <BR>
<a href="https://www.ncbi.nlm.nih.gov/pubmed/24791748"><strong>&quot;Whole-scalp EEG mapping of somatosensory evoked potentials in macaque monkeys&quot;</strong>,<BR>A.-D. Gindrat, C. Quairiaux, J. Britz, D. Brunet, F. Lanz, C.M. Michel, E.M. Rouiller,<BR><em>Brain Structure and Function</em>, 2014</a> <BR> <BR>
<a href="https://onlinelibrary.wiley.com/doi/10.1155/2011/813870"><strong>&quot;Spatiotemporal Analysis of Multichannel EEG: CARTOOL&quot;</strong>,<BR>D. Brunet, M.M. Murray, C.M. Michel,<BR><em>Computational Intelligence and Neuroscience</em>, 2011</a></PRE>

         <H3>
             <em>&quot;The practice&quot;</em>
         </H3>
         <P>
             Now that you have read all the above articles ;-) let's go practical.
         </P>
         <P>
             The purpose of these computations is to produce mainly:
         </P>
         <UL>
             <LI CLASS="mvd-P">
                 <P>
                     a <B>matrix,</B>
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     a <B>set of fixed loci in the brain</B> (called the solution points,
                     SPs, or solution space).
                 </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <P>
             The matrix is later <B>multiplied by an EEG column</B>, which gives a <B>column</B>
             made of <B>3D vectors</B>. Each of these 3D vectors is <B>localized</B>
             by its corresponding <B>solution point</B>, and is equivalent to a <B>
                 small
                 dipole
             </B> of any orientation and intensity.
         </P>
         <P>
             <B>Computing the matrix and solution points</B> has to be done <B>
                 only
                 once
             </B> for a given head and electrodes configuration, which is the
             purpose of this section. The last stage of multiplying by some EEG
             data is later done either in <A HREF="esi-display.html"><B>real-time</B></A>,
             through the <a href="computing-ris.html"><strong>dedicated RIS toolbox</strong></a>
             (<em>highly recommended</em>), or finally to <strong>
                 <a href="ris-to-volumes.html">convert results to volumes</a>
             </strong>.
         </P>
         <H2>
             <A NAME="running-creation"></A>Creating the matrices
         </H2>
         <P>
             <B>We can not emphasize enough how sensitive the whole computation is</B>,
             and that <B>great care</B> should be taken as <B>
                 each of these steps
                 is a whole process in itself
             </B>:
         </P>
         <OL>
             <LI CLASS="mvd-P">
                 <P>
                     <A HREF="#mris-preprocessing">Preprocessing the </A><B><A HREF="#mris-preprocessing">MRIs</A></B>
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     <A HREF="#electrodes-setup">Coregistering the </A><B><A HREF="#electrodes-setup">electrodes</A></B><A HREF="#electrodes-setup">
                         on the head
                     </A>
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     <A HREF="#solution-space">Defining the </A><B>
                         <A HREF="#solution-space">
                             Solution
                             Space
                         </A>
                     </B>
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     <A HREF="#lead-field-comput">Computing the </A><B>
                         <A HREF="#lead-field-comput">
                             Lead
                             Field
                         </A>
                     </B><A HREF="#lead-field-comput"> (LF):</A>
                 </P>
                 <UL>
                     <LI CLASS="mvd-P">
                         <P>
                             <A HREF="#grey-mask">Extracting the Grey mask</A>, <A HREF="#SPs-extraction">
                                 generating
                                 the Solution Points loci
                             </A>
                         </P>
                     <LI CLASS="mvd-P">
                         <P>
                             Choosing the <A HREF="#lead-field-comp-det">LF model</A>
                         </P>
                 </UL>
             <LI CLASS="mvd-P">
                 <P>
                     <A HREF="#inverse-solution">Using the LF to solve the </A><B>
                         <A HREF="#inverse-solution">
                             Inverse
                             Problem
                         </A>
                     </B>
                 </P>
                 <UL>
                     <LI CLASS="mvd-P">
                         <P>
                             Choosing the <A HREF="#IS-types">Inverse model</A>: <A HREF="#IS-LORETA"><B>LORETA</B></A>,
                             <A HREF="#IS-LAURA"><B>LAURA</B></A>, <A HREF="#IS-WMN">
                                 <B>
                                     Weighted
                                     Minimum Norm
                                 </B>
                             </A>, etc..
                         </P>
                 </UL>
         </OL>
         <P>
             &nbsp;
         </P>
         <P>
             It is suggested to <B>try each of these 5 steps one at a time</B>,
             until you get a grasp of each of them. Plus, you can very often <B>
                 re-use
                 the results from a previous run
             </B>, like re-orientation of the MRIs
             or coregistration, that actually has to be done only once...
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             Also see the <I><A HREF="#dialog-drag-drop"><B>Drag &amp; Drop</B></A></I>
             paragraph to learn some handy behaviors to save time (and nerves?).
         </P>
         <P>
             &nbsp;
         </P>
         <P ALIGN=LEFT>
             Called from the&nbsp; <FONT FACE="Arial Black,Arial,Helvetica">
                 <A HREF="all-processings.html#tools">
                     Tools
                     | Inverse Solutions | Creating Inverse Solution Matrices
                 </A>
             </FONT>&nbsp; menu, the following dialog holds all the
             parameters, organized in <B>5 (quite) independent parts</B>:
         </P>
         <CENTER>
             <P ALIGN=CENTER>
                 <img height="849" src="images/cris.dialog.png" width="707">
             </P>
         </CENTER>
         <P>
             &nbsp;
         </P>
         <P>
             <TABLE WIDTH="100%" CELLPADDING="5" CELLSPACING="0" BORDER="1">
                 <TR>
                     <TD WIDTH="27%" VALIGN=TOP>
                         <P>
                             <B><A HREF="#mris-preprocessing">(1) MRIs Preprocessing</A></B>
                     </TD>
                     <TD WIDTH="73%" VALIGN=TOP>
                         &nbsp;
                     </TD>
                 </TR>
                 <TR>
                     <TD WIDTH="27%" VALIGN=TOP>
                         <P>
                             MRIs
                             Presets:
                     </TD>
                     <TD WIDTH="73%" VALIGN=TOP>
                         <P>
                             Quick setup for the <B>MRIs</B> preprocessing part, then you can tune up the
                             buttons to your liking.
                         </P>
                         <P>
                             Presets might change according to version, but mainly allow you to
                             choose:<ul>
                                 <li>
                                     <strong>Real Heads</strong> (i.e. subjects or patients) <em>vs</em>
                                     <strong>Template Heads</strong> (average of multiple subjects)
                                 </li>
                                 <li>
                                     <strong><a href="mris-preprocessing.html">Already preprocessed</a></strong>
                                     <em>vs</em> <strong>still in need of some tuning</strong>
                                 </li>
                             </ul>
                     </TD>
                 </TR>
                 <TR>
                     <TD WIDTH="27%" VALIGN=TOP>
                         <P>
                             <A HREF="#mris-input">Full Head MRI:</A>
                     </TD>
                     <TD WIDTH="73%" VALIGN=TOP>
                         <P>
                             File with the <B>full head</B>, preferably with the <A HREF="#mris-properties">
                                 following
                                 properties
                             </A>.
                     </TD>
                 </TR>
                 <TR>
                     <TD WIDTH="27%" VALIGN=TOP>
                         <P>
                             <A HREF="#mris-input">Full Brain MRI:</A>
                     </TD>
                     <TD WIDTH="73%" VALIGN=TOP>
                         <P>
                             File with the <B>skull-stripped brain</B>, i.e. it should contain the
                             grey &amp; white matters, and preferably the cerebellum, with the <A HREF="#mris-properties">
                                 following
                                 properties
                             </A>.
                     </TD>
                 </TR>
                 <tr>
                     <TD WIDTH="27%" VALIGN=TOP>
                         <P>
                             <A HREF="#mris-input">Grey Mask MRI (optional):</A>
                     </TD>
                     <TD WIDTH="73%" VALIGN=TOP>
                         <P>
                             Optional file with the Grey Mask.
                         <P>
                             It is recommended to <em>
                                 let Cartool compute this mask by letting this
                                 field empty
                             </em>. The Cartool Grey Mask <strong>is much thicker</strong>
                             than the usual Grey Matter masks given by other packages, and fulfills
                             other purposes.
                     </TD>
                 </tr>
                 <tr>
                     <TD WIDTH="27%" VALIGN=TOP>
                         <P>
                             <A HREF="#skull-from-tissues-file">Segmented Tissues Head file:</A>
                     </TD>
                     <TD WIDTH="73%" VALIGN=TOP>
                         <P>
                             Optional, though highly recommend, <strong>
                                 full head volume segmented
                                 into tissues
                             </strong>. This can really improve on the <strong>
                                 <A HREF="#dialog-lead-field-tissues">Lead Field computation</A>
                             </strong>
                             later on.
                     </TD>
                 </tr>
                 <TR>
                     <TD WIDTH="27%" VALIGN=TOP></TD>
                     <TD WIDTH="73%" VALIGN=TOP></TD>
                 </TR>
                 <TR>
                     <TD WIDTH="27%" VALIGN=TOP>
                         <P>
                             <A HREF="#mris-processing">MRIs Preprocessing:</A>
                     </TD>
                     <TD WIDTH="73%" VALIGN=TOP>
                         <P>
                             Apply any of these steps on the MRIs, with this sequence:
                     </TD>
                 </TR>
                 <TR>
                     <TD WIDTH="27%" VALIGN=TOP>
                         <UL>
                             <P>
                                 <A HREF="#mris-bias-field-cor">Bias Field Correction</A>
                     </TD>
                     <TD WIDTH="73%" VALIGN=TOP>
                         <P>
                             Compensates the Bias Field <I>for the brain only</I>, to allow for a
                             better grey/white matters segmentation.
                         </P>
                         <P>
                             If the bias field has been already corrected for, it doesn't really
                             hurt to do it again, though it is a useless step.
                         </P>
                         <P>
                             BTW, there is also no need to run the Bias Field correction on templates,
                             as it was certainly done at some point during construction.
                     </TD>
                 </TR>
                 <TR>
                     <TD WIDTH="27%" VALIGN=TOP>
                         <UL>
                             <P>
                                 <A HREF="#mris-filter">Filter Noise</A>
                     </TD>
                     <TD WIDTH="73%" VALIGN=TOP>
                         <P>
                             MRI data are noisy, plus the scalp can have creases and ridges due to
                             lying on the back, or having cushions / earphones / electrodes on the
                             head. In either cases, we need to smooth out these folds so that the
                             surface of the head appears more regular:
                         </P>
                         <UL>
                             <LI CLASS="mvd-P">
                                 <P>
                                     <B>Median filter</B> (2.83 voxels diameter, equivalent to 18 neighbors),
                                 </P>
                             <LI CLASS="mvd-P">
                                 <P>
                                     <B>Gaussian filter</B> (6.5 voxels diameter).
                     </TD>
                 </TR>
                 <TR>
                     <TD WIDTH="27%" VALIGN=TOP>
                         <UL>
                             <P>
                                 <A HREF="#mris-reorient">Realign SPM-style</A>
                     </TD>
                     <TD WIDTH="73%" VALIGN=TOP>
                         <P>
                             <B>Re-orient axis to RAS</B> (X:<B>R</B>ight, Y:<B>A</B>nterior, Z:<B>S</B>uperior),
                             SPM-compatible orientation. We also use the neurological convention, <I>not</I>
                             the radiological one, that is the <B>
                                 right part of the head is seen
                                 the right side
                             </B>.
                     </TD>
                 </TR>
                 <TR>
                     <TD WIDTH="27%" VALIGN=TOP>
                         <UL>
                             <P>
                                 <A HREF="#sagittal-plane">+ Set Sagittal Plane</A>
                     </TD>
                     <TD WIDTH="73%" VALIGN=TOP>
                         <P>
                             This parameter is highly recommended in case the head is not
                             perfectly aligned with the Y-Z sagittal plane. It will search for the <B>
                                 optimal
                                 sagittal plane
                             </B> and reorient the head to fit it into the Y-Z
                             plane. It needs the <B>full head</B> as input.
                         </P>
                         <P>
                             The search is done with <B>3 parameters</B>: 1 translation in X
                             (left-right ), 2 rotations around Y and Z.
                         </P>
                         <P>
                             See here for <A HREF="#mris-origin">setting the origin</A>.
                     </TD>
                 </TR>
                 <TR>
                     <TD WIDTH="27%" VALIGN=TOP>
                         <UL>
                             <P>
                                 <A HREF="#equatorial-plane">+ Set Transverse Plane</A>
                     </TD>
                     <TD WIDTH="73%" VALIGN=TOP>
                         <P>
                             <em>Note:</em> this step is not longer mandatory, Cartool can do
                             without...
                         </P>
                         <P>
                             Search the brain for the <B>cutting slice with the maximum transverse extent</B>,
                             and reorient the head to fit it into the X-Y plane. This is <I>not</I>
                             an AC-PC realignment, just a geometrical one. It needs the <B>brain</B>
                             as input.
                         </P>
                         <P>
                             The search is done with <B>2 parameters</B>: 1 translation in Z
                             (vertical ), 1 rotation around X.
                         </P>
                         <P>
                             See here for <A HREF="#mris-origin">setting the origin</A>.
                     </TD>
                 </TR>
                 <TR>
                     <TD WIDTH="27%" VALIGN=TOP></TD>
                     <TD WIDTH="73%" VALIGN=TOP></TD>
                 </TR>
                 <TR>
                     <TD WIDTH="27%" VALIGN=TOP>
                         <P>
                             <B><A HREF="#electrodes-setup">(2) Electrodes Preprocessing</A></B>
                     </TD>
                     <TD WIDTH="73%" VALIGN=TOP>
                         &nbsp;
                     </TD>
                 </TR>
                 <TR>
                     <TD WIDTH="27%" VALIGN=TOP>
                         <P>
                             Electrodes
                             Presets:
                     </TD>
                     <TD WIDTH="73%" VALIGN=TOP>
                         <P>
                             Quick setup for the <B>electrodes</B> preprocessing part.
                         </P>
                         <P>
                             Current presets are the following:<ul>
                                 <li>
                                     <strong>Interactively coregistering</strong> the electrodes to the
                                     full head MRI
                                 </li>
                                 <li>
                                     <strong>Interactively refining</strong> already coregistered
                                     electrodes
                                 </li>
                                 <li>
                                     The <strong>coregistration has already been done</strong>, just
                                     load the file - no checks performed!
                                 </li>
                             </ul>
                     </TD>
                 </TR>
                 <TR>
                     <TD WIDTH="27%" VALIGN=TOP>
                         <P>
                             <A HREF="#electrodes-propert">Loading Electrodes Coordinates file:</A>
                     </TD>
                     <TD WIDTH="73%" VALIGN=TOP>
                         <P>
                             &nbsp;File with the <A HREF="files-formats-others.html#electrodes-coord">
                                 electrodes
                                 coordinates
                             </A>.
                     </TD>
                 </TR>
                 <TR>
                     <TD WIDTH="27%" VALIGN=TOP></TD>
                     <TD WIDTH="73%" VALIGN=TOP></TD>
                 </TR>
                 <TR>
                     <TD WIDTH="27%" VALIGN=TOP>
                         <P>
                             <B><A HREF="#solution-space">(3) Solution Space</A></B>
                     </TD>
                     <TD WIDTH="73%" VALIGN=TOP>
                         <P>
                             <B><A HREF="#solution-space">See: Solution Space</A></B> and <A HREF="#combining-sps-and-lf">
                                 <B>
                                     Solution
                                     Space
                                 </B><I><B>vs</B></I><B> Lead Field cases</B>
                             </A>
                     </TD>
                 </TR>
                 <tr>
                     <TD WIDTH="27%" VALIGN=TOP>
                         <P>
                             Solution Space
                             Presets:
                     </TD>
                     <TD WIDTH="73%" VALIGN=TOP>
                         <P>
                             Quick setup for the <B>solution space</B> processing part.
                         </P>
                         <P>
                             Current presets are the following:<ul>
                                 <li>
                                     <strong>Computing the solution points, adult case.</strong> A
                                     &quot;low-pass&quot; version of the grey matter will be estimated first, then
                                     downsampled.
                                 </li>
                                 <li>
                                     <strong>Computing the solution points, newborn case.</strong> This
                                     will skip differentiating the grey and the white matter and use the
                                     whole brain.
                                 </li>
                                 <li>Reloading some existing solution points - no checks performed!</li>
                                 <li>
                                     When reloading a full Lead Field (see below), use the solution
                                     points associated with it
                                 </li>
                             </ul>
                     </TD>
                 </tr>
                 <TR>
                     <TD WIDTH="27%" VALIGN=TOP>
                         <P>
                             Targeted
                             Number of Solution Points:
                     </TD>
                     <TD WIDTH="73%" VALIGN=TOP>
                         <P>
                             Specify here the <I>desired</I> number of <A HREF="#SPs-extraction">Solution Points</A>,
                             which is actually a sub-sampling of the <A HREF="#grey-mask">Grey mask</A>.
                         </P>
                         <P>
                             The actual number will be as close as possible to the user input, but
                             will certainly slightly differ.
                         </P>
                         <P>
                             See this topic about the <A HREF="#SPs-number">number of solution points</A>.
                         <P>
                             &nbsp;
                         <P>
                             This field is also used when reloading a Lead Field, and can be used to
                             limit the number of solution points to retain. If not empty, Cartool will
                             therefor <A HREF="#same-sp-as-lf">downsample the solution space</A>
                             / <A HREF="#lead-field-downsamp">Lead Field</A>.
                         <P>
                             And BTW, it is much better to <A HREF="#combining-sps-and-lf">
                                 interpolate
                                 the Lead Field with Cartool own computed Solution Points
                             </A>...
                     </TD>
                 </TR>
                 <tr>
                     <TD WIDTH="27%" VALIGN=TOP>Brain to Grey Mask conversion:</TD>
                     <TD WIDTH="73%" VALIGN=TOP>
                         You can control how the grey mask will be
                         extracted from the brain.
                     </TD>
                 </tr>
                 <tr>
                     <TD WIDTH="27%" VALIGN=TOP>
                         <UL>
                             <P>
                                 <A HREF="#grey-mask-processin">Thick Grey Mask</A>
                     </TD>
                     <TD WIDTH="73%" VALIGN=TOP>
                         This is the default option in Cartool. It extracts
                         a kind of <A HREF="#grey-mask-vs-matter">band around the grey matter</A>,
                         as to make sure the solution space will not have holes in it.
                     </TD>
                 </tr>
                 <tr>
                     <TD WIDTH="27%" VALIGN=TOP>
                         <UL>
                             <P>
                                 <A HREF="#grey-mask-whole-brain">Whole Brain Mask</A>
                     </TD>
                     <TD WIDTH="73%" VALIGN=TOP>
                         Some rare case need to bypass the Regular option
                         above, and use the whole brain instead.<br>These cases are when the Grey
                         Matter / White Matter detection fails, as for Babies / Newborns or Monkeys.
                     </TD>
                 </tr>
                 <TR>
                     <TD WIDTH="27%" VALIGN=TOP>
                         <P>
                             <A HREF="#loading-sps">Loading Solution Points File</A>
                     </TD>
                     <TD WIDTH="73%" VALIGN=TOP>
                         <P>
                             You can otherwise <B>load an existing Solution Points file</B>.
                             Either to save time because you have already computed it before, or
                             to be able to compare results by varying other parameters.
                         </P>
                         <P>
                             <A HREF="#SPs-distribution">Solution Points is a very sensitive topic</A>,
                             be careful not to load erroneous points!
                     </TD>
                 </TR>
                 <TR>
                     <TD WIDTH="27%" VALIGN=TOP></TD>
                     <TD WIDTH="73%" VALIGN=TOP></TD>
                 </TR>
                 <TR>
                     <TD WIDTH="27%" VALIGN=TOP>
                         <P>
                             <B><A HREF="#lead-field-comput">(4) Lead Field (Forward Model)</A></B>
                     </TD>
                     <TD WIDTH="73%" VALIGN=TOP>
                         <P>
                             <A HREF="#lead-field-comput"><B>See: Lead Field processing</B></A>
                             and <A HREF="#combining-sps-and-lf">
                                 <B>Solution Space </B><I><B>vs</B></I><B>
                                     Lead Field cases
                                 </B>
                             </A>
                     </TD>
                 </TR>
                 <TR>
                     <TD WIDTH="27%" VALIGN=TOP>
                         <P>
                             Lead Field
                             Presets:
                     </TD>
                     <TD WIDTH="73%" VALIGN=TOP>
                         <P>
                             Quick setup for the <B>Lead Field </B>processing part.
                         </P>
                         <P>
                             Actual presets might vary on your current version of Cartool, but here are the main
                             usual choices:<ul>
                                 <li>
                                     All models currently use the <strong>
                                         <A HREF="#lsmac-model">
                                             LSMAC (Locally Spherical
                                             Model with Anatomical Constraints) geometrical transform
                                         </A>
                                     </strong>,
                                     which in itself is closer to a BEM model than a simple spherical model.
                                 </li>
                                 <li>
                                     <strong><A HREF="#exact-equations">3-Shell</A></strong> (scalp, skull,
                                     CSF + brain) <strong>
                                         real
                                         head shape model
                                     </strong>, with <strong>exact analytic equations.</strong>
                                     To be used just for tests.
                                 </li>
                                 <li>
                                     <strong><A HREF="#exact-equations">4-Shell</A></strong> (scalp, skull, CSF, brain) <strong>
                                         real
                                         head shape model
                                     </strong>, with <strong>exact analytic equations. Recommended model.</strong>
                                 </li>
                                 <li>
                                     <strong><A HREF="#exact-equations">6-Shell</A></strong> (scalp,
                                     skull compact, skull spongious, skull compact, CSF, brain) <strong>
                                         real
                                         head shape model
                                     </strong>, with <strong>exact analytic equations. Also recommended model.</strong>
                                 </li>
                                 <li>
                                     <strong><A HREF="#Ary-approximation">3-Shell</A></strong> (scalp, skull, CSF + brain altogether)
                                     <strong>real head shape model</strong>, with <strong>
                                         Ary dipole
                                         approximation.
                                     </strong> To be used for backward compatibility only.
                                 </li>
                                 <li>
                                     <strong><A HREF="#lead-field-loading">Reloading an existing Lead Field file</A></strong>. Useful to recompute the
                                     inverse part below, or to test other packages.
                                 </li>
                             </ul>
                     </TD>
                 </TR>
                 <TR>
                     <TD WIDTH="27%" VALIGN=TOP></TD>
                     <TD WIDTH="73%" VALIGN=TOP></TD>
                 </TR>
                 <tr>
                     <TD WIDTH="27%" VALIGN=TOP>
                         <P>
                             <A NAME="dialog-lead-field-tissues"></A>Tissues Boundaries Estimated from:
                     </TD>
                     <TD WIDTH="73%" VALIGN=TOP>
                         <P>
                             Lead Field computation needs to know, among other things, the <strong>
                                 boundaries between a few tissues
                             </strong>:<ul>
                                 <li><strong>Brain, Skull &amp; Scalp</strong> for a <strong>3-Shell model</strong></li>
                                 <li><strong>+ CSF</strong> for a <strong>4-Shell model</strong></li>
                                 <li>
                                     <strong>+&nbsp; Skull Spongy and Skull Compact</strong> for
                                     <strong>6-Shell model</strong>
                                 </li>
                             </ul>
                         <P>
                             These boundaries can currently be retrieved by 2 means.
                     </TD>
                 </tr>
                 <tr>
                     <td VALIGN="TOP" WIDTH="27%">
                         <ul>
                             <P>
                                 <A HREF="#skull-from-mri">T1 MRIs</A>
                         </ul>
                     </td>
                     <TD WIDTH="73%" VALIGN=TOP>
                         <P>
                             By scanning the input T1 MRIs (head and brain), Cartool can <strong>
                                 approximate
                                 the brain, CSF, skull and scalp boundaries
                             </strong>. Though no not perfect,
                             it is still
                             quite robust and accurate enough that it can be used for subjects / patients cases. It also works OK for template.
                     </TD>
                 </tr>
                 <tr>
                     <td VALIGN="TOP" WIDTH="27%">
                         <ul>
                             <P>
                                 <A HREF="#skull-from-tissues-file">Segmented Tissues</A>
                         </ul>
                     </td>
                     <TD WIDTH="73%" VALIGN=TOP>
                         <P>
                             An already <strong>full head segmented tissues file can be provided</strong>, with each voxels
                             labelled as grey matter, white matter, CSF, skull, scalp, and even eyes,
                             blood, air etc... This gives the best results, but this labelling should be done ahead of time
                             by using another toolbox for
                             the time being. For the <strong>MNI 2009c asymmetric template</strong>, a
                             <strong>segmented tissues volume is available for download</strong>.
                     </TD>
                 </tr>
                 <tr>
                     <TD WIDTH="27%" VALIGN=TOP>Targeted age:</TD>
                     <TD WIDTH="73%" VALIGN=TOP class="auto-style1">
                         Mean age for the estimation of skull thickness
                         and relative conductivity, in the range [0..100] years.<br>Setting an age will automatically update
                         these two values according to curves estimated from the literature.
                     </TD>
                 </tr>
                 <tr>
                     <TD WIDTH="27%" VALIGN=TOP>
                         <P><A HREF="#skull-age-to-conductivity">Skull Absolute Conductivity:</A>
                     </TD>
                     <TD WIDTH="73%" VALIGN=TOP>
                         <P>
                             Absolute conductivity of the skull, in [S/m].
                         </P>
                     </TD>
                 </tr>
                 <tr>
                     <TD WIDTH="27%" VALIGN=TOP>
                         <P><A HREF="#skull-age-to-thickness">Adjusting Skull Mean Thickness:</A>
                     </TD>
                     <TD WIDTH="73%" VALIGN=TOP>
                         Mean thickness of the upper part of the skull,
                         in [mm].<br>The automatic <A HREF="#skull-from-mri">
                             skull thickness
                             detection
                         </A> actually gives relative thicknesses. They are converted to
                         absolute with the help of this value.<br><br>Note that this option can be
                         independently toggled off, in case user has given a segmented tissues file
                         to exactly rely upon.
                     </TD>
                 </tr>
                 <tr>
                     <TD WIDTH="27%" VALIGN=TOP></TD>
                     <TD WIDTH="73%" VALIGN=TOP></TD>
                 </tr>
                 <TR>
                     <TD WIDTH="27%" VALIGN=TOP>
                         <P>
                             <A HREF="#lead-field-loading">Loading Lead Field</A>
                     </TD>
                     <TD WIDTH="73%" VALIGN=TOP>
                         <P>
                             Reload a previously computed LF from file.
                         </P>
                         <P>
                             Either to save time to re-compute only the inversion part, or you
                             might have computed the LF in another toolbox.
                     </TD>
                 </TR>
                 <TR>
                     <TD WIDTH="27%" VALIGN=TOP>
                         <UL>
                             <P>
                                 <A HREF="#lead-field-inputfil">Loading Lead Field File:</A>
                     </TD>
                     <TD WIDTH="73%" VALIGN=TOP>
                         <P>
                             When <B><A HREF="#lead-field-loading">loading the Lead Field from file</A></B>,
                             this is the <A HREF="#lead-field-inputfil">Lead Field matrix</A> file
                             itself.
                     </TD>
                 </TR>
                 <TR>
                     <TD WIDTH="27%" VALIGN=TOP>
                         <UL>
                             <P>
                                 <A HREF="#lead-field-inputfil">Associated Solution Points File:</A>
                     </TD>
                     <TD WIDTH="73%" VALIGN=TOP>
                         <P>
                             You have to <A HREF="#lead-field-inputfil">load a Solution Points file</A>
                             associated with the above loaded Lead Field!
                     </TD>
                 </TR>
                 <TR>
                     <TD WIDTH="27%" VALIGN=TOP></TD>
                     <TD WIDTH="73%" VALIGN=TOP></TD>
                 </TR>
                 <TR>
                     <TD WIDTH="27%" VALIGN=TOP>
                         <P>
                             <B><A HREF="#inverse-solution">(5) Inversion (Inverse Model)</A></B>
                     </TD>
                     <TD WIDTH="73%" VALIGN=TOP>
                         &nbsp;
                     </TD>
                 </TR>
                 <TR>
                     <TD WIDTH="27%" VALIGN=TOP>
                         <P>
                             <A HREF="#IS-types">Inverse Models:</A>
                     </TD>
                     <TD WIDTH="73%" VALIGN=TOP>
                         <P>
                             This is where the Lead Field matrix, that computes the voltage received
                             at each electrode from the dipoles' currents, is
                             <A HREF="#IS-inverse-step">
                                 mathematically
                                 &quot;inverted&quot;
                             </A>, and will allow us to <em>estimate</em> the
                             dipoles' currents from the electrodes voltage (magic!).
                         <P>
                             There are quite a few models available here, all of them being from the
                             <em>Minimum Norm</em> family.
                         <P>
                             Also note that the inversion part is <I>
                                 totally independent
                                 from the Lead Field model part!
                             </I>
                     </TD>
                 </TR>
                 <tr>
                     <TD WIDTH="27%" VALIGN=TOP>
                         <UL>
                             <P>
                                 <B><A HREF="#IS-MN">Minimum Norm</A></B>
                     </TD>
                     <TD WIDTH="73%" VALIGN=TOP>
                         <P>
                             The ancestor of all methods below. The simplest of all.
                     </TD>
                 </tr>
                 <tr>
                     <TD WIDTH="27%" VALIGN=TOP>
                         <UL>
                             <P>
                                 <B><A HREF="#IS-WMN">Weighted Minimum Norm</A></B>
                     </TD>
                     <TD WIDTH="73%" VALIGN=TOP>
                         <P>
                             Simple derivation from the MN above.
                     </TD>
                 </tr>
                 <tr>
                     <TD WIDTH="27%" VALIGN=TOP>
                         <UL>
                             <P>
                                 <A HREF="#IS-sDale"><strong>s</strong><span class="auto-style10"><strong>Dale</strong></span></A>
                     </TD>
                     <TD WIDTH="73%" VALIGN=TOP>
                         <P>
                             Inspired by the Dale article, kind of similar to <em>dSPM</em>.
                     </TD>
                 </tr>
                 <tr>
                     <TD WIDTH="27%" VALIGN=TOP>
                         <UL>
                             <P>
                                 <B><A HREF="#IS-sLORETA">sLORETA</A></B>
                     </TD>
                     <TD WIDTH="73%" VALIGN=TOP>
                         <P>
                             A standardized MN.
                     </TD>
                 </tr>
                 <tr>
                     <TD WIDTH="27%" VALIGN=TOP>
                         <UL>
                             <P>
                                 <B><A HREF="#IS-LORETA">LORETA</A></B>
                     </TD>
                     <TD WIDTH="73%" VALIGN=TOP>
                         <P>
                             Variation to MN with smoothness constraint. The most robust to noise.
                     </TD>
                 </tr>
                 <TR>
                     <TD WIDTH="27%" VALIGN=TOP>
                         <UL>
                             <P>
                                 <B><A HREF="#IS-LAURA">LAURA</A></B>
                     </TD>
                     <TD WIDTH="73%" VALIGN=TOP>
                         <P>
                             Sibling to LORETA, with another approach to the smoothness constraint.
                             Also robust to noise.
                     </TD>
                 </TR>
                 <tr>
                     <TD WIDTH="27%" VALIGN=TOP>
                         <UL>
                             <P>
                                 <B><A HREF="#IS-eLORETA">eLORETA</A></B>
                     </TD>
                     <TD WIDTH="73%" VALIGN=TOP>
                         <P>
                             Has no errors in localization the max, but only on specific conditions.
                     </TD>
                 </tr>
                 <TR>
                     <TD WIDTH="27%" VALIGN=TOP></TD>
                     <TD WIDTH="73%" VALIGN=TOP></TD>
                 </TR>
                 <TR>
                     <TD WIDTH="27%" VALIGN=TOP>
                         <P>
                             (<A HREF="#IS-regularization">Tikhonov Regularization</A>:)
                     </TD>
                     <TD WIDTH="73%" VALIGN=TOP>
                         <P>
                             <em>Note:</em> previous versions of Cartool used to the <B>
                                 <A HREF="#IS-regularization">Tikhonov regularization</A>
                             </B> as an
                             <strong>option</strong>.
                             But as this option was nearly mandatory, it has been removed from the
                             User Interface. <strong>The regularization is now systematically computed!</strong>
                             Plus, the non-regularized matrix is still embedded within the saved
                             matrices, should you feel bad about that...<br>
                         </P>
                         <P>
                             Includes a <B>Tikhonov regularization</B> parameter in the inverse
                             process. This is highly recommended when dealing with noisy data (so,
                             all data?).
                         </P>
                         <P>
                             You need <I><A HREF="#IS-regularization">not</A></I><A HREF="#IS-regularization">
                                 specify the Tikhonov constant
                             </A> itself, instead a range of
                             constants will be deduced from the current inverse matrix. You end up
                             with as many matrices as there are constants, all <A HREF="#IS-stack-matrices">
                                 packed
                                 into a super-matrix
                             </A>, from which you could select the best one
                             according to your data.
                         </P>
                         <P>
                             The actual Tikhonov constants can be found in the <A HREF="#IS-results">
                                 verbose
                                 file
                             </A>, though (we know you couldn't sleep without knowing them).
                     </TD>
                 </TR>
                 <TR>
                     <TD WIDTH="27%" VALIGN=TOP></TD>
                     <TD WIDTH="73%" VALIGN=TOP></TD>
                 </TR>
                 <TR>
                     <TD WIDTH="27%" VALIGN=TOP>
                         <P>
                             <B>Options</B>
                     </TD>
                     <TD WIDTH="73%" VALIGN=TOP>
                         <P>
                             &nbsp;
                     </TD>
                 </TR>
                 <TR>
                     <TD WIDTH="27%" VALIGN=TOP>
                         <P>
                             Output Base File Name
                     </TD>
                     <TD WIDTH="73%" VALIGN=TOP>
                         <P>
                             Base directory and file names for all output files.
                     </TD>
                 </TR>
                 <TR>
                     <TD WIDTH="27%" VALIGN=TOP>
                         <P>
                             <A NAME="dialog-piloting"></A>User annoyance level:
                     </TD>
                     <TD WIDTH="73%" VALIGN=TOP>
                         <P>
                             How much you want to follow and check each processing step?
                     </TD>
                 </TR>
                 <TR>
                     <TD WIDTH="27%" VALIGN=TOP>
                         <UL>
                             <P>
                                 Interactive Processing
                     </TD>
                     <TD WIDTH="73%" VALIGN=TOP>
                         <P>
                             <B>Follow each step</B> of the processing, <B>checking the intermediate results</B>
                             and <B>answering</B> questions to confirm their validity when needed.
                         </P>
                         <P>
                             If something seems wrong to you, you will usually get kicked out of
                             the process, and invited by a specific message to check your data.
                     </TD>
                 </TR>
                 <TR>
                     <TD WIDTH="27%" VALIGN=TOP>
                         <UL>
                             <P>
                                 Batch Processing
                     </TD>
                     <TD WIDTH="73%" VALIGN=TOP>
                         <P>
                             This will run in a <B>fully automatic mode</B>, without asking any
                             feedbacks, so that it can be run in the background or in parallel. <B>
                                 Check
                                 the verbose file
                             </B> and all output files however!
                         </P>
                         <P>
                             &nbsp;
                         </P>
                         <P>
                             <B><I>Avoid this option</I></B>
                         </P>
                         <UL>
                             <LI CLASS="mvd-P">
                                 <P>
                                     until you get confident enough into all the steps of the inverse solution,
                                 </P>
                                 <P>
                                     <B><I>and</I></B>
                                 </P>
                             <LI CLASS="mvd-P">
                                 <P>
                                     you absolutely know your data very well (like running again
                                     previously processed data)!
                                 </P>
                         </UL>
                         <P>
                             <B><I>Otherwise</I></B>, please refrain from the Black-Box temptation
                             and don't click on this, <B><I>do interactively monitor the process!</I></B>
                         </P>
                         <P>
                             &nbsp;
                         </P>
                         <P>
                             If something seems to fail during the process, usually Cartool will
                             stop the whole thing, but in some places, it will try to continue anyway.
                     </TD>
                 </TR>
             </TABLE>
         </P>
         <H3>
             <I><A NAME="dialog-drag-drop"></A>Drag &amp; Drop</I>ping files
         </H3>
         <P>
             You can <I>Drag &amp; Drop</I> any of the input files into the
             dialog, for quicker action. This is usually an un-ambiguous behavior,
             f.ex. dropping a <B>.xyz</B> file is only meant to be the electrodes
             used for the coregistration.
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             The case worth mentionning now is when <B>dropping some </B><A HREF="#lead-field-inputfil">
                 <B>
                     Solution
                     Points files
                 </B>
             </A>, because they can be either the <A HREF="#lead-field-inputfil">
                 Solution
                 Points associated with a Lead Field
             </A>, or the <A HREF="#loading-sps">
                 Solution
                 Points for the output Solution Space
             </A>. Then the following rules
             apply that fit most of the cases:
         </P>
         <P>
             &nbsp;
         </P>
         <UL>
             <LI CLASS="mvd-P">
                 <P>
                     If a <B>Lead Field is already known</B> (or is also dropped together):
                 </P>
                 <UL>
                     <LI CLASS="mvd-P">
                         <P>
                             A Solution Points file with the <B>same number of solution points</B>
                             will be <A HREF="#lead-field-inputfil"><B>associated with this Lead Field</B>;</A>
                         </P>
                     <LI CLASS="mvd-P">
                         <P>
                             Conversely, any other Solution Points file will be assigned to <A HREF="#loading-sps">
                                 <B>
                                     the
                                     output Solution Space
                                 </B>.
                             </A>
                         </P>
                 </UL>
             <LI CLASS="mvd-P">
                 <P>
                     If <B><I>no </I>Lead Field is known</B>:
                 </P>
                 <UL>
                     <LI CLASS="mvd-P">
                         <P>
                             If <B>2 Solution Points files</B> are dropped
                         </P>
                         <UL>
                             <LI CLASS="mvd-P">
                                 <P>
                                     the one with the <B>highest number of Solution Points is </B><A HREF="#lead-field-inputfil">
                                         <B>
                                             associated
                                             with the Lead Field
                                         </B>
                                     </A>,
                                 </P>
                             <LI CLASS="mvd-P">
                                 <P>
                                     the other one to the <A HREF="#loading-sps"><B>output Solution Space</B></A>.
                                 </P>
                         </UL>
                     <LI CLASS="mvd-P">
                         <P>
                             For any other number of Solution Points files (usually 1), the file
                             is assigned to the <B>closest field it has been dropped on</B> in the window.
                         </P>
                 </UL>
         </UL>
         <H2>
             <A NAME="mris-preprocessing"></A>MRIs preprocessing for inverse solutions
         </H2>
         <P>
             &nbsp;
         </P>
         <H5>
             <A HREF="#mris-input">MRIs input</A>
         </H5>
         <UL>
             <H5>
                 <A HREF="#mris-properties">MRIs properties</A><br><A HREF="#mris-good-ex">MRIs good examples</A><br>
                 <A HREF="#mris-bad-ex">MRIs bad examples</A>
             </H5>
         </UL>
         <H5>
             <A HREF="#mris-processing">MRIs processing</A>
         </H5>
         <UL>
             <H5>
                 <A HREF="#mris-bias-field-cor">Bias Field correction</A><br>
				 <A HREF="#mris-filter">Filter noise</A><br>
                 <A HREF="#mris-reorient">Realign</A>
             </H5>
             <UL>
                 <H5>
                     <A HREF="#ras-orientation">RAS orientation</A><br>
                     <A HREF="#sagittal-plane">Sagittal plane</A><br>
                     <A HREF="#equatorial-plane">Equatorial plane</A>
                 </H5>
             </UL>
             <H5>
                 <A HREF="#mris-origin">Setting the origin</A>
             </H5>
         </UL>
         <H5>
             <A HREF="#mris-results">MRIs results</A>
         </H5>
         <UL>
             <H5>
                 <A HREF="#mris-good-res">MRIs good results</A><br><A HREF="#mris-bad-res">MRIs bad results</A>
             </H5>
         </UL>
         <P>
             &nbsp;
         </P>
         <H3>
             <A NAME="mris-input"></A>MRIs input
         </H3>
         <P>
             You need <B>two or three <A HREF="files-formats-others.html#mri">MRI</A></B> files as input:
         </P>
         <UL>
             <LI CLASS="mvd-P">
                 <P>
                     Mandatory, the <B>full head</B>, with as much of the neck / face / jaw as
                     possible
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     Mandatory, the <B>segmented brain</B>:
                 </P>
                 <UL>
                     <LI CLASS="mvd-P">
                         <P>
                             <B>grey &amp; white matters</B> together;
                         </P>
                     <LI CLASS="mvd-P">
                         <P>
                             but <B>skull-stripped</B>
                         </P>
                     <LI CLASS="mvd-P">
                         <P>
                             preferably with the <strong>cerebellum</strong>
                         </P>
                 </UL>
             <LI CLASS="mvd-P">
                 <P>
                     Optionally, you can provide the <strong>Grey Mask</strong> of your
                     liking, although Cartool has its own way to compute it...
                 </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <P>
             F.ex. a subject's full head, brain and grey mask as computed by Cartool:
         </P>
         <P class="auto-style1">
             <img height="293" SRC="images/cris.mri-full-head.png" width="306"><img height="293" SRC="images/cris.mri-brain.png" width="307"><img height="293" SRC="images/cris.mri-grey-mask.png" width="307">
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             Note that if you miss the brain MRI part, you can still perform some
             very basic transformations, like resizing or re-orienting, but of
             course not the whole inverse computation!
         </P>
         <P>
             &nbsp;
         </P>
         <H4>
             <A NAME="mris-properties"></A>MRIs properties
         </H4>
         <P>
             The input MRIs should fulfill the following conditions:
         </P>
         <UL>
             <LI CLASS="mvd-P">
                 <P>
                     Accepted file formats are: <a href="files-formats-others.html#mri">
                         <strong>Nifti1</strong>,
                         <strong>Nifti2</strong>
                         or <B>Analyze</B>
                     </a>.
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     They could be either of a <B>template head</B> (MNI f.ex.) or some <B>
                         subject
                         / patient's head
                     </B>.
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     The <B>full head</B> should ideally be big enough to include the <B>
                         face
                         &amp; neck
                     </B>, but Cartool could cope with a cropped head at
                     cerebellum/ear level.<br>Also <strong>
                         anything other than the head should be
                         <a href="mri-display.html#editing">manually deleted</a>
                     </strong>, like headphones, tubes, wires etc..
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     All MRIs should be <B>T1</B>s, of <B>any size</B>. Anisotropic volumes will
                     be resliced on the fly.
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     All MRIs should share the <B>same orientation</B>, though it
                     can be of <B>any type</B>.
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     MRIs should of course be in a <B>right-hand</B> coordinate system (right
                     part is seen on the right). This was a problem with the old Analyze format,
                     but not anymore with Nifti.
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     The <B>brain</B> and <strong>grey mask</strong> MRIs should <B>fit exactly</B> into its
                     corresponding head (no
                     tiny shifts, no rotations...).
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     <strong>Brain</strong> should preferably <B>contain the cerebellum</B>.
                 </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <P>
             If some of these conditions are not fulfilled, you have to somehow
             prepare your data <I>before</I> entering this part, either in Cartool
             or in some other utilities (MRICro, SPM...).
         </P>
         <P>
             &nbsp;
         </P>
         <H4>
             <A NAME="mris-good-ex"></A>See some good examples of MRIs input:
         </H4>
         <P>
             A full MRI that includes the <B>whole face is better</B>, i.e. the
             jaw &amp; neck, as it will be easier to coregister the electrodes on it:
         </P>
         <UL>
             <P>
                 <IMG SRC="images/cris.full-head-db.png" VSPACE="0" HSPACE="0" BORDER="0">
             </P>
         </UL>
         <P>
             These MRIs have been <B>cropped at ear level</B>, which is <B>less ideal</B>
             but Cartool will try to proceed anyway. Also note that these 2
             examples have a <B>different orientation systems</B>, and Cartool
             will cope with that, too:
         </P>
         <UL>
             <P>
                 <IMG SRC="images/cris.full-head-mni.png" VSPACE="0" HSPACE="0" BORDER="0"><IMG SRC="images/cris.full-head-al.png" VSPACE="0" HSPACE="0" BORDER="0">
             </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <H4>
             <A NAME="mris-bad-ex"></A>See some bad examples of MRIs input:
         </H4>
         <P>
             Here are some bad matches between the brain and the full head (slight
             lag, and wrong orientation respectively):
         </P>
         <UL>
             <P>
                 <IMG SRC="images/cris.full-head-and-brain-bad1.png" VSPACE="0" HSPACE="0" BORDER="0"><IMG SRC="images/cris.full-head-and-brain-bad2.png" VSPACE="0" HSPACE="0" BORDER="0">
             </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <P>
             Here is another problem: headphones were used and are still visible on the
             MRI. These for sure will interfere with the head modelling, as if it were
             part of the head! <strong>
                 So anything &quot;floatting around&quot; the head should be
                 <a href="mri-display.html#editing">deleted beforehand</a>
             </strong>:
         </P>
         <P class="auto-style1">
             <img alt="" height="280" SRC="images/cris.full-head-bad3.png" width="293">&nbsp;
         </P>
         <P>
             &nbsp;
         </P>
         <H3>
             <A NAME="mris-processing"></A>MRIs processing
         </H3>
         <p>
             We strongly recommend to <strong>
                 do as much preprocessing as possible before
                 entering this toolbox
             </strong>. For example with the <strong>
                 <a href="mris-preprocessing.html">MRI Preprocessing toolbox</a>
             </strong> of
             Cartool. However, for cases where this is not possible, you still have a few
             of the following options as fallback.
         </p>
         <H4>
             <A NAME="mris-bias-field-cor"></A>Bias Field correction
         </H4>
         <P>
             This operation is performed only on the <B>brain MRI</B>.
         </P>
         <P>
             It aims at
             reducing a MRI artifact that causes intensities to be <B>
                 slightly
                 amplified according to position
             </B>, with a low-frequency type of
             pattern. It is a good idea to try to reduce this artifact before
             trying to separate the grey matter from the brain!
         </P>
         <P>
             The method used here has been designed specifically for Cartool, and
             works by scanning the MRI in many directions, and for each direction
             by looking at the distribution of the histogram and applying a
             correction along this axis. The artifact is modeled as a
             multiplicative factor.
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             See here an example before and after Bias Field correction:
         </P>
         <P>
             <IMG SRC="images/cris.mri-bias-field-before.png" VSPACE="0" HSPACE="0" BORDER="0"><IMG SRC="images/cris.mri-bias-field-after.png" VSPACE="0" HSPACE="0" BORDER="0">
         </P>
         <P>
             &nbsp;
         </P>
         <H4>
             <A NAME="mris-filter"></A>Filter noise
         </H4>
         <P>
             Two filters are applied <strong>internally</strong> (you don't <em>see</em>
             these), to remove some <B>noise</B> and to smooth out
             the <B>ripples from the scalp surface</B>:
         </P>
         <UL>
             <LI CLASS="mvd-P">
                 <P>
                     <B>Median filter</B> (2.83 voxels diameter, equivalent to 18 neighbors),
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     <B>Gaussian filter</B> (6.5 voxels diameter).
                 </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <P>
             See here an example of before and after filters, just for the sake of
             demonstration, as <em>this is all done internally</em>:
         </P>
         <UL>
             <P>
                 <IMG SRC="images/cris.filters-before.png" VSPACE="0" HSPACE="0" BORDER="0"><IMG SRC="images/cris.filters-after.png" VSPACE="0" HSPACE="0" BORDER="0">
             </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <P>
             Note that these filters are usually <I>not</I> needed with the templates,
             as they are already quite noise-free.
         </P>
         <P>
             &nbsp;
         </P>
         <H4>
             <A NAME="mris-reorient"></A>Realign
         </H4>
         <P>
             This includes either 1 to 3 steps:
         </P>
         <UL>
             <LI CLASS="mvd-P">
                 <P>
                     Always setting the <B><A HREF="#ras-orientation">orientation to the RAS</A></B> (SPM-compatible
                     / default Nifti orientation);
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     Optionally aligning the <B><A HREF="#sagittal-plane">sagittal plane</A></B>
                     to the plane that cuts the brain into <B>2 hemispheres</B>;
                 </P>
                 <P>
                     and/or
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     Optionally aligning the <B><A HREF="#equatorial-plane">equatorial plane</A></B>
                     to the <B>biggest transverse slice of the brain</B>.
                 </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <UL>
             <H4>
                 <A NAME="ras-orientation"></A>RAS orientation
             </H4>
         </UL>
         <P>
             This aims at re-arranging the axis so that:
         </P>
         <UL>
             <LI CLASS="mvd-P">
                 <P>
                     X axis points toward the <B>R</B>ight side
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     Y axis points toward the <B>A</B>nterior side
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     Z axis points toward the <B>S</B>uperior side
                 </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <P>
             See an example, going from the <B>PIR</B> (Posterior, Inferior,
             Right) orientation to the <B>RAS</B> orientation (look at the <I>color</I>
             of the axis, as the labels on the border always indicate the meaning
             of the axis, and so won't change!):
         </P>
         <UL>
             <P>
                 <IMG SRC="images/cris.orientation-pir.png" ALIGN=CENTER VSPACE="0" HSPACE="0" BORDER="0">--&gt;<IMG SRC="images/cris.orientation-ras.png" ALIGN=CENTER VSPACE="0" HSPACE="0" BORDER="0">
             </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <P>
             Note that globally, Cartool is quite independent of any orientation
             system, but for the sake of simplicity, working here only with the
             RAS system makes things much easier and less error prone.
         </P>
         <P>
             There will be some outputs that will go <B>
                 back into your original
                 MRI size and orientation
             </B>. That way you can visualize and compare
             results with your other modalities.
         </P>
         <P>
             &nbsp;
         </P>
         <UL>
             <H4>
                 <A NAME="sagittal-plane"></A>Sagittal plane
             </H4>
         </UL>
         <P>
             This is an <strong>important step</strong> that has to be done at some point
             in the MRI processing! We wish to have an <strong>
                 as precise as possible
                 cutting mid-sagittal plane
             </strong>, which will allow us to nicely distribute
             solution points &quot;equally&quot; on the left and right cortex. The alternative is
             that points would be entangled in a single slice, or mixed between left and
             right!
         </P>
         <P>
             This option will find the optimal <B>sagittal plane</B> that cuts the brain into <B>2 hemispheres</B>,
             search being done within the <B>full head</B>. The search is done with <B>3 parameters</B>:
             1 translation in X (left-right ), 2 rotations around Y and Z.
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             See an example here, with the found sagittal plane superimposed in transparency:
         </P>
         <UL>
             <P>
                 <IMG SRC="images/cris.sagittal-plane.png" VSPACE="0" HSPACE="0" BORDER="0">
             </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <P>
             Note that this is still an <I>approximation</I>: the 2 hemispheres never
             exactly split equally with a simple plane, especially around the visual
             cortex.
         </P>
         <P>
             &nbsp;
         </P>
         <UL>
             <H4>
                 <A NAME="equatorial-plane"></A>Transverse plane
             </H4>
         </UL>
         <P>
             This option will realign the transverse plane in a fashion that closely
             resembles to the MNI template. This will bring more consistent and visually
             pleasing results.
         </P>
         <P>
             Find the optimal <B>transverse plane</B>, the one that <B>
                 cuts the
                 brain with the biggest extent
             </B> (length x width). The search is
             done with <B>2 parameters</B>: 1 translation in Z (vertical ), 1
             rotation around X.
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             See an example here, with the found transverse plane superimposed in transparency:
         </P>
         <UL>
             <P>
                 <IMG SRC="images/cris.equatorial-plane.png" VSPACE="0" HSPACE="0" BORDER="0">
             </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <H4>
             <A NAME="mris-origin"></A>Setting the origin
         </H4>
         <P>
             This step is <I>not</I> listed in the dialog box, because it is <B>mandatory</B>
             and done all the time!
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             We need to set a <B>geometrical center</B> for the brain, the point
             from which the brain could best seen as fitting to a sphere (though
             we do not explicitly do it). This is because the LSMAC
             Lead Field model make use of a <B>spherical model</B>, and therefore
             need a reasonable center to compute the relative radii between
             solution points and electrodes.
         </P>
         <P>
             In the usual case, the <B>middle of the intersection line</B> of the <B>
                 sagittal
                 plane and equatorial plane
             </B> is taken:
         </P>
         <UL>
             <P>
                 <IMG SRC="images/cris.mris-origin.png" VSPACE="0" HSPACE="0" BORDER="0">
             </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <P>
             If <B>only</B> the sagittal or the equatorial planes have been
             computed, the missing information is used from the <B>
                 center of the
                 brain's bounding box
             </B>, and sometimes the origin of the brain, if
             it is set.
         </P>
         <P>
             If <B>neither</B> the sagittal nor the equatorial planes have been
             computed, the origin is the <B>center of the brain's bounding box</B>,
             or the origin if it is set.
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             <B>
                 We strongly recommend to always use <A HREF="#sagittal-plane">
                     both
                     planes detection
                 </A>, except for the MNI template which only needs
                 the equatorial plane detection!
             </B>
         </P>
         <P>
             &nbsp;
         </P>
         <H3>
             <A NAME="mris-results"></A>MRIs results
         </H3>
         <P>
             We are dealing here with the results of the <A HREF="#mris-preprocessing">
                 <B>
                     MRIs
                     preprocessing
                 </B>
             </A> section only:
         </P>
         <UL>
             <LI CLASS="mvd-P">
                 <P>
                     <B>1 to 3 MRIs</B>, depending to your inputs and processing options, saved in
                     <A HREF="files-formats-others.html#mri">Nifti format</A>;
                 </P>
                 <UL>
                     <LI CLASS="mvd-P">
                         <P>
                             MRI file&nbsp; <I>basefilename.Head.nii</I>&nbsp; contains the full head;
                         </P>
                     <LI CLASS="mvd-P">
                         <P>
                             MRI file&nbsp; <I>basefilename.Brain.nii</I>&nbsp; contains the full head;
                         </P>
                     <LI CLASS="mvd-P">
                         <P>
                             MRI file&nbsp; <I>basefilename.Grey.nii</I>&nbsp;
                             contains the grey mask;
                         </P>
                 </UL>
             <LI CLASS="mvd-P">
                 <P>
                     MRIs can be <B>resampled, reoriented</B>, <B>cropped </B>and <B>centered</B>
                     according to the <A HREF="#mris-processing">given parameters</A>;
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     These files are written <B>unfiltered</B> (filtering is used only at
                     processing time).
                 </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <H4>
             <A NAME="mris-good-res"></A>See some good examples of MRIs results:
         </H4>
         <P>
             <B>Before</B> the Sagittal &amp; Equatorial search, reorientation,
             and centering:
         </P>
         <UL>
             <P>
                 <IMG SRC="images/cris.mri-before1.png" VSPACE="0" HSPACE="0" BORDER="0"><IMG SRC="images/cris.mri-before2.png" VSPACE="0" HSPACE="0" BORDER="0"><IMG SRC="images/cris.mri-before3.png" VSPACE="0" HSPACE="0" BORDER="0">
             </P>
         </UL>
         <P>
             And <B>after</B> the successful reorientation:
         </P>
         <UL>
             <P>
                 <IMG SRC="images/cris.mri-after1.png" VSPACE="0" HSPACE="0" BORDER="0"><IMG SRC="images/cris.mri-after2.png" VSPACE="0" HSPACE="0" BORDER="0"><IMG SRC="images/cris.mri-after3.png" VSPACE="0" HSPACE="0" BORDER="0">
             </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <H4>
             <A NAME="mris-bad-res"></A>See some bad examples of MRIs results:
         </H4>
         <P>
             Here the Sagittal and Equatorial searches totally <B>failed</B> (this
             is an example, which has been fixed since then):
         </P>
         <UL>
             <P>
                 <IMG SRC="images/cris.mri-after-bad2.png" VSPACE="0" HSPACE="0" BORDER="0"><IMG SRC="images/cris.mri-after-bad1.png" VSPACE="0" HSPACE="0" BORDER="0">
             </P>
         </UL>
         <H2>
             <A NAME="electrodes-setup"></A>Electrodes preprocessing
         </H2>
         <P>
             &nbsp;
         </P>
         <H5>
             <A HREF="#electrodes-input">Electrodes input</A>
         </H5>
         <UL>
             <H5>
                 <A HREF="#electrodes-propert">Electrodes properties</A><br>
                 <A HREF="#electrodes-good-ex">Electrodes good examples</A><br>
                 <A HREF="#electrodes-bad-ex">Electrodes bad examples</A>
             </H5>
         </UL>
         <H5>
             <A HREF="#electrodes-coreg">Electrodes coregistration</A>
         </H5>
         <UL>
             <H5>
                 <A HREF="#coreg-nothing">Doing nothing</A><br><A HREF="#coreg-already">Electrodes already coregistered</A><br>
                 <A HREF="#electrodes-manual">Interactive coregistration</A><br>
                 <A HREF="#rework-coreg">Rework interactive coregistration</A>
             </H5>
         </UL>
         <H5>
             <A HREF="#electrodes-results">Electrodes results</A>
         </H5>
         <UL>
             <H5>
                 <A HREF="#electrodes-good-res">Electrodes good results</A><br>
                 <A HREF="#electrodes-bad-res">Electrodes bad results</A>
             </H5>
         </UL>
         <P>
             &nbsp;
         </P>
         <H3>
             <A NAME="electrodes-input"></A>Electrodes input
         </H3>
         <P>
             You need <B>
                 one <A HREF="files-formats-others.html#electrodes-coord">
                     electrodes
                     file
                 </A>
             </B> as input:
         </P>
         <UL>
             <LI CLASS="mvd-P">
                 <P>
                     The surface electrodes of your recording
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     <strong>
                         Any auxiliary / fiducial / funky electrode should be removed
                         beforehand!
                     </strong>
                 </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <H4>
             <A NAME="electrodes-propert"></A>Electrodes properties
         </H4>
         <P>
             The input electrodes should have the following properties:
         </P>
         <UL>
             <LI CLASS="mvd-P">
                 <P>
                     File formats <B><I><A HREF="files-formats-cartool.html#xyz">.xyz</A></I></B>
                     or <B><I><A HREF="files-formats-cartool.html#els">.els</A></I></B>.
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     Only the <B>surface electrodes</B> should be there, <I>no</I>
                     auxiliaries, <I>no</I> landmarks etc...
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     The electrodes should cover <B>as much surface as possible</B> of the head.
                     It might be a good idea to work with 257 electrodes f.ex. then remove some
                     electrodes after the coregistration.
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     There should be <B>enough electrodes</B>, at least <strong>64 and above</strong>.
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     It could be either an electrodes <B>template</B>, or the electrodes
                     measured from a <B>real head</B>.
                 </P>
                 <P>
                     In the latter case, the measures should be <B>as accurate as possible</B>,
                     as this has a direct impact on the reliability of&nbsp;the inverse solutions!
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     The template <B>should preferably be <em>non-</em>spherical</B>, i.e. it is
                     far better to have a <strong>real head shape</strong>.
                     <a href="coregistering-electrodes-to-mri.html#glueing">There are work-around, though</a>.
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     <B>Input orientation can be arbitrary</B>, and can even be different from
                     the orientation of the MRIs. This will be reworked during processing.
                 </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <P>
             &nbsp;
         </P>
         <H4>
             <A NAME="electrodes-good-ex"></A>See some good examples of electrodes:
         </H4>
         <P>
             The first two are electrodes templates with different number of
             electrodes, the third one is a subject's real electrodes, all of them
             being OK:
         </P>
         <UL>
             <P>
                 <IMG SRC="images/cris.el-ok1.png" VSPACE="0" HSPACE="0" BORDER="0"><IMG SRC="images/cris.el-ok3.png" VSPACE="0" HSPACE="0" BORDER="0"><IMG SRC="images/cris.el-ok2.png" VSPACE="0" HSPACE="0" BORDER="0">
             </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <H4>
             <A NAME="electrodes-bad-ex"></A>See some bad examples of electrodes:
         </H4>
         <P>
             <B>Not enough electrodes</B> (29!), plus it has a <B>spherical</B>
             shape. Don't even <I>think</I> of using this:
         </P>
         <UL>
             <P>
                 <IMG SRC="images/cris.el-bad3.png" VSPACE="0" HSPACE="0" BORDER="0">
             </P>
         </UL>
         <P>
             Globally enough electrodes, but <B>doesn't cover the head enough</B>.
             To totally <I>avoid</I> as inverses won't work properly:
         </P>
         <UL>
             <P>
                 <IMG SRC="images/cris.el-bad1.png" VSPACE="0" HSPACE="0" BORDER="0">
             </P>
         </UL>
         <P>
             Enough electrodes, with a good coverage of the head, but has a <B>
                 spherical
                 shape
             </B>. This is not ideal, though you might be able to <A HREF="coregistering-electrodes-to-mri.html#glueing">
                 proceed
                 through
             </A>, but still not recommended:
         </P>
         <UL>
             <P>
                 <IMG SRC="images/cris.el-bad2.png" VSPACE="0" HSPACE="0" BORDER="0">
             </P>
         </UL>
         <P>
             Real measured electrodes with heavily corrupted coordinates. Better use a template in this case:
         </P>
         <UL>
             <P>
                 <IMG SRC="images/cris.el-bad4.png" VSPACE="0" HSPACE="0" BORDER="0">
             </P>
         </UL>
         <P>
             This is a good template file, but you need to remove the <B>
                 lone
                 electrodes / landmarks
             </B> that &quot;float&quot; below the surface:
         </P>
         <UL>
             <P>
                 <IMG SRC="images/cris.el-bad5.png" VSPACE="0" HSPACE="0" BORDER="0">
             </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <H3>
             <A NAME="electrodes-coreg"></A>Electrodes coregistration
         </H3>
         <P>
             Here are the available processing on the electrodes set.
         </P>
         <P>
             &nbsp;
         </P>
         <h5>
             <A NAME="coreg-nothing"></A>Doing nothing
         </h5>
         <P>
             <B>Don't make use of the electrodes</B> at all, so no Lead Field and
             no Inverse Solution either...
         </P>
         <P>
             Note: this is set from <I>Presets</I> list, there is no button for this.
         </P>
         <P>
             &nbsp;
         </P>
         <h5>
             <A NAME="coreg-already"></A>Electrodes already coregistered
         </h5>
         <P>
             Load and <B>use the electrodes file</B>, which <B>should alreay fit exactly</B>
             on the Head MRI: same orientation, centering &amp; scaling.
         </P>
         <P>
             Note: if the MRIs are going through some geometrical transforms
             (re-scaling, re-orientation, rotations etc...), then the same
             transforms will be applied to the electrodes coordinates, as to
             remain correctly coregistered.
         </P>
         <P>
             &nbsp;
         </P>
         <h5>
             <A NAME="electrodes-manual"></A>Interactive coregistration
         </h5>
         <P>
             The user has to <B><a href="coregistering-electrodes-to-mri.html">manually coregister</a></B> the electrodes set to the
             head, in <B>real time</B>. It is his/her responsibility to make sure
             the electrodes set is coregistered correctly: positioning the Fpz /
             Cz / Oz electrodes, respecting the symmetry on the head etc...
         </P>
         <P>
             It will launch the <strong>
                 <a href="coregistering-electrodes-to-mri.html">
                     Coregistration Toolbox
                 </a>
             </strong>, and resume to the Inverse Matrices
             toolbox soon after.
         </P>
         <P>
             &nbsp;
         </P>
         <h5>
             <A NAME="rework-coreg"></A>Interactively refining an existing coregistration
         </h5>
         <P>
             This follows the exact same process as the <B>
                 <A HREF="#electrodes-manual">
                     Interactive
                     coregistration
                 </A>
             </B>, except that the electrodes model is loaded
             as is, without computing a new center, orientation or size. It
             assumes the <B>model is already well adjusted</B> to the head
             surface, and only needs some <B>slight adjustments</B>.
         </P>
         <P>
             &nbsp;
         </P>
         <H3>
             <A NAME="electrodes-results"></A>Electrodes results
         </H3>
         <P>
             We are dealing here with the results of the <A HREF="#electrodes-setup">
                 <B>
                     Electrodes
                     processing
                 </B>
             </A> section alone:
         </P>
         <UL>
             <LI CLASS="mvd-P">
                 <P>
                     <B>2 electrodes set</B>, saved in <B><I><A HREF="files-formats-cartool.html#xyz">.xyz</A></I></B><A HREF="files-formats-cartool.html#xyz"> format</A>:
                 </P>
                 <UL>
                     <LI CLASS="mvd-P">
                         <P>
                             One file&nbsp; <I>basefilename.xyz</I>&nbsp; is the one used for the
                             actual IS computation, which should <B>
                                 fit as much as possible the
                                 surface of the head
                             </B>.
                         </P>
                     <LI CLASS="mvd-P">
                         <P>
                             One file&nbsp; <I>basefilename.For Display.xyz</I>&nbsp; is a
                             modified version of the previous one, where the electrodes have been
                             slightly <B>pushed away</B> from the surface, only to produce a more
                             visually pleasing display when superimposed to the MRI.
                         </P>
                         <P>
                             As its name implies, this version is <B><I>for display use only</I></B>,
                             and <em>should not be re-used for any computation</em>!
                         </P>
                 </UL>
             <LI CLASS="mvd-P">
                 <P>
                     Both sets are <B><A HREF="#electrodes-coreg">coregistered</A></B> to
                     the <A HREF="#mris-input">full head MRI</A>;
                 </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <H4>
             <A NAME="electrodes-good-res"></A>See some good examples of
             electrodes set results:
         </H4>
         <P>
             The result from coregistering a template electrodes set to a real
             head, with the results <I>not glued</I> to the surface.
         </P>
         <P>
             First picture is the &quot;official&quot; result, and as it is so
             close to the surface, you get this half-blent appearance, which is
             normal. Second picture is the same with some <A HREF="potentials-maps-display.html#depth-shifting">depth-shifting</A>
             on the electrodes, for a better visual result. Third picture is the <I>
                 <A HREF="#electrodes-results">
                     For
                     Display
                 </A>
             </I> version, more appropriate for display use:
         </P>
         <UL>
             <P>
                 <IMG SRC="images/cris.el-coreg-ok1.png" VSPACE="0" HSPACE="0" BORDER="0"><IMG SRC="images/cris.el-coreg-ok2.png" VSPACE="0" HSPACE="0" BORDER="0"><IMG SRC="images/cris.el-coreg-ok3.png" VSPACE="0" HSPACE="0" BORDER="0">
             </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <H4>
             <A NAME="electrodes-bad-res"></A>See some bad examples of electrodes
             set results:
         </H4>
         <P>
             Here is an example when <B><A HREF="#coreg-already">just loading</A></B>
             an electrodes set and <B>assuming it is coregistered</B>, when indeed
             it is not (guess the results won't be that good?):
         </P>
         <UL>
             <P>
                 <IMG SRC="images/cris.el-coreg-bad2.png" VSPACE="0" HSPACE="0" BORDER="0">
             </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <P>
             Here is an example where <B><A HREF="coregistering-electrodes-to-mri.html#glueing">gluing</A></B>
             should have been avoided, the electrodes landing <I>inside</I> the
             head through the MRI's defect is <I>not</I> a good thing:
         </P>
         <UL>
             <P>
                 <IMG SRC="images/cris.el-glue11.png" WIDTH="260" HEIGHT="249" VSPACE="0" HSPACE="0" BORDER="0">
             </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <H2>
             <A NAME="solution-space"></A>Solution Space
         </H2>
         <P>
             &nbsp;
         </P>
         <H5>
             <A HREF="#grey-mask">Grey mask extraction</A>
         </H5>
         <UL>
             <H5>
                 <A HREF="#grey-mask-processin">Grey mask processing</A><br>
                 <A HREF="#grey-mask-vs-matter">Grey mask vs Grey matter</A><br>
                 <A HREF="#grey-mask-whole-brain">Whole brain as grey mask</A>
             </H5>
         </UL>
         <H5>
             <A HREF="#SPs-extraction">Solution Points computation</A>
         </H5>
         <UL>
             <H5>
                 <A HREF="#SPs-distribution">SPs Left-right distribution</A><br>
                 <A HREF="#SPs-neighborhood">SPs Minimum neighborhood</A><br>
                 <A HREF="#SPs-continuity">SPs Continuity</A><br><A HREF="#SPs-number">Number of SPs</A><br>
                 <A HREF="#SPs-results">SPs Results</A>
             </H5>
         </UL>
         <H5>
             <A HREF="#loading-sps">Loading Solution Points</A><br>
             <A HREF="#same-sp-as-lf">Same Solution Points as Lead Field</A>
         </H5>
         <P>
             &nbsp;
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             The <B>solution space</B> is the next thing you need to work on after
             the electrodes. It gives the positions of the points <B>
                 where the
                 inverse solution will be computed
             </B>.
         </P>
         <P>
             The user can:
         </P>
         <UL>
             <LI CLASS="mvd-P">
                 <P>
                     Let <A HREF="#SPs-extraction">Cartool compute the Solution Points</A>,
                     which is optimal for the next operations
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     <A HREF="#loading-sps">Load an existing file &quot;as is&quot;</A>,
                     and trust it is well defined
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     Use the <A HREF="#same-sp-as-lf">Solution Points from a reloaded Lead Field</A>
                 </P>
         </UL>
         <P>
             This, together with the <A HREF="#lead-field-comput">Lead Field options</A>,
             allows for <A HREF="#combining-sps-and-lf">all possible of combinations</A>.
         </P>
         <P>
             &nbsp;
         </P>
         <H3>
             <A NAME="grey-mask"></A>Grey Mask extraction
         </H3>
         <P>
             Most of the time, we need a <B>mask of the brain's grey matter</B>:
         </P>
         <UL>
             <LI CLASS="mvd-P">
                 <P>
                     From which the <B><A HREF="#SPs-extraction">Solution Points</A></B>
                     will be computed;
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     For <B>
                         <A HREF="esi-display.html#how-to-get-it">
                             displaying the
                             Inverse Solutions
                         </A>
                     </B> in that area only.
                 </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <P>
             (this step is performed automatically when <A HREF="#SPs-extraction">
                 computing
                 the Solution Points
             </A>, so there is no explicit option for this in
             the dialog)
         </P>
         <P>
             &nbsp;
         </P>
         <H4>
             <A NAME="grey-mask-processin"></A>Grey mask processing
         </H4>
         <P>
             Cartool processes the <B>brain into a grey mask</B> the following way:
         </P>
         <UL>
             <LI CLASS="mvd-P">
                 <P>
                     <A HREF="#mris-bias-field-cor">Correcting for the <B>Bias Field</B></A> (optionally),
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     Estimating the global <B>intensity distributions</B> of the Grey /
                     White / &quot;Black&quot; matters with a Mixture of Gaussians,
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     <B>Classifying each voxel</B> into Grey / White / &quot;Black&quot;
                     matters by mixing:
                 </P>
                 <UL>
                     <LI CLASS="mvd-P">
                         <P>
                             <B>Gaussian probabilities</B> based on <B>intensity</B>
                         </P>
                     <LI CLASS="mvd-P">
                         <P>
                             <B>Neighbors likelihood</B> (more grey neighbors -&gt; higher chance
                             to be grey, too)
                         </P>
                 </UL>
             <LI CLASS="mvd-P">
                 <P>
                     <B>Smoothing</B> / filling holes of the resulting grey mask. This step is
                     quite important before the ensuing downsampling to solution points!
                 </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <P>
             Note that this conversion can also be ran from the MRI Window, with
             the&nbsp; <FONT FACE="Arial Black,Arial,Helvetica">
                 Filters | Brain
                 processing | Segment to Grey Matter
             </FONT>&nbsp; menu, and choosing
             the <I>Regular</I> or <em>Fat</em> method.
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             See here an example of the grey mask extraction:
         </P>
         <P>
             <IMG SRC="images/cris.grey-example-1.png" VSPACE="0" HSPACE="0" BORDER="0"><IMG SRC="images/cris.grey-example-2.png" VSPACE="0" HSPACE="0" BORDER="0">
         </P>
         <P>
             &nbsp;
         </P>
         <H4>
             <A NAME="grey-mask-vs-matter"></A>Grey mask vs Grey matter
         </H4>
         <P>
             The <B>grey mask</B> extracted by Cartool is <B>thicker</B> than your
             usual <B>grey matter</B>, which can be quite thin near some given
             areas of the brain.
         </P>
         <P>
             This is an important point, as <B>smoothing</B> is always required <B>
                 before
                 correctly downsampling
             </B> to Solution Points. Otherwise we end up
             with aliasing effects (Nyquist theorem) of the solution space:
             missing points where the spatial frequency is below the downsampling
             spatial frequency. So please keep in mind that the grey mask
             extraction is <I>more</I> than a grey matter extraction, and <B>
                 is
                 better done the &quot;Cartool way&quot; to ensure a correct solution space
             </B>.
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             See here an example of a subject's Grey matter (on the left), and the
             corresponding Grey mask from Cartool (on the right):
         </P>
         <P>
             <IMG SRC="images/cris.grey-matter.png" VSPACE="0" HSPACE="0" BORDER="0"><IMG SRC="images/cris.grey-mask.png" VSPACE="0" HSPACE="0" BORDER="0">
         </P>
         <P>
             &nbsp;
         </P>
         <P class="mvd-h4">
             <A NAME="grey-mask-whole-brain"></A>Whole brain as grey mask
         </P>
         <P>
             There are some cases where the usual Grey mask extraction will fail. The most
             common cases are when the histograms of the Grey vs White matters are not
             correctly estimated: for newborns, or animals like monkeys or mice.
         </P>
         <P>
             In that case, just use the option to compute the grey mask on the whole
             brain. It will still poke out the csf parts, but after downsampling you might
             get solution points in the Black matter (csf). It doesn't harm the inverse
             solution whatsoever, and the inverse shouldn't give you any significatn
             results in those points.
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             Here is an example on newborn, first showing the Grey mask, then the brain
             with the superimposed solution points:
         </P>
         <P>
             <img alt="Grey mask on the whole brain of newborn" height="336" SRC="images/cris.grey-mask.full-1.png" width="348"><img alt="" height="336" SRC="images/cris.grey-mask.full-2.png" width="348">
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             &nbsp;
         </P>
         <H3>
             <A NAME="SPs-extraction"></A>Solution Points computation
         </H3>
         <P>
             The <A HREF="#grey-mask">Grey mask</A> is basically <B>downsampled</B>
             (with great care) into the Solution Points the following way:
         </P>
         <UL>
             <LI CLASS="mvd-P">
                 <P>
                     Run a downsampling loop, with a <B>non-integer downsampling factor</B>:
                 </P>
                 <UL>
                     <LI CLASS="mvd-P">
                         <P>
                             <B>Downsample the grey mask</B>, centered around the <B>geometrical center</B>,
                         </P>
                     <LI CLASS="mvd-P">
                         <P>
                             Remove voxels with <B>less than 8 neighbors out of 26</B>,
                         </P>
                     <LI CLASS="mvd-P">
                         <P>
                             <B>Count remaining voxels</B>,
                         </P>
                         <UL>
                             <LI CLASS="mvd-P">
                                 <P>
                                     if close enough to the desired results, exit the downsampling loop,
                                 </P>
                             <LI CLASS="mvd-P">
                                 <P>
                                     otherwise, slightly adjust the downsampling factor and repeat the loop
                                 </P>
                         </UL>
                 </UL>
         </UL>
         <P>
             &nbsp;
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             See here an example of a slice of a grey mask, with the corresponding
             converted SPs on top:
         </P>
         <P>
             <IMG SRC="images/cris.sp-from-grey-mask.png" VSPACE="0" HSPACE="0" BORDER="0">
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             Actually, the Solution Points extraction is an <B>important step</B>
             of the Inverse Solutions, very often overlooked, if not totally
             ignored in the literature. Here are some points which Cartool is
             especially taking care of.
         </P>
         <H4>
             <A NAME="SPs-distribution"></A>SPs Left-right distribution
         </H4>
         <P>
             First, remember that the MRIs should have been <A HREF="#sagittal-plane">
                 aligned
                 with their midsagittal plane
             </A>. That means the <A HREF="#mris-origin">
                 <B>
                     geometrical
                     center
                 </B>
             </A> of the MRIs is going through a YZ plane (the
             midsagittal plane) that cuts the <B>brain in two (nearly) equal parts</B>.
         </P>
         <P>
             When downsampling the grey matter into the SPs, the new <B>
                 SPs
                 downsampled center
             </B> has to remain through this <B>midsagittal plane</B>.
             This way will ensure that the resulting SPs distribution will be
             optimally distributed across the midsagittal plane, with <B>
                 no side
                 receiving more SPs than the other one
             </B>.
         </P>
         <P>
             Otherwise, having an asymmetrical distribution of SPs will have a
             dramatic impact on the inverse solutions, with more weights given to
             one side of the brain, or even results that could be assigned the <A HREF="#SPs-continuity">
                 wrong
                 side of the brain
             </A>! Of course, a <I>real</I> asymmetrical
             (pathological) brain will have its midsagittal plane set according to
             its anatomy, and <I>will</I> have an asymmetrical distribution of
             SPs. The point is, the distribution of SPs has to reflect the
             reality, and not to artificially favor one side over the other.
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             See here an incorrectly downsampled grey mask (on the left), with too
             many SPs on the right side (especially near the midsagittal plane),
             and a correct one (on the right), with the little remaining
             left-right differences stemming from the actual shape of the brain:
         </P>
         <P>
             <IMG SRC="images/cris.sp-bad-example-1.png" VSPACE="0" HSPACE="0" BORDER="0"><IMG SRC="images/cris.sp-good-example-1.png" VSPACE="0" HSPACE="0" BORDER="0">
         </P>
         <P>
             &nbsp;
         </P>
         <H4>
             <A NAME="SPs-neighborhood"></A>SPs Minimum neighborhood
         </H4>
         <P>
             The inverse process will later need the computation of a <B>discrete Laplacian</B>
             in the Solution Space. To be able to do that correctly, each solution
             point has to have <B>enough neighbors</B>. We drew a quite
             conservative limit for each Solution Point to have at least <B>
                 8
                 neighbors out of 26
             </B>, and the ones who don't fulfill this
             criterion to be removed.
         </P>
         <P>
             &nbsp;
         </P>
         <H4>
             <A NAME="SPs-continuity"></A>SPs Continuity
         </H4>
         <P>
             With this <A HREF="#SPs-extraction">method</A>, we aim to <B>
                 have SPs
                 even in the thinnest parts
             </B> of the grey matter, and to have an <B>
                 even
                 coverage
             </B> of the grey matter as a whole. It should be obvious
             that there can not be any inverse solution results on non-existent
             SPs (!), resulting in a lack of precision for some brain areas.
         </P>
         <P>
             Another risk, if some SPs were to be missing in some grey matter
             parts, and some brain activity were to be coming from these very same
             areas, would be that the <B>closest SPs to the missing parts</B>
             would be ellicited by the inverse solution. But the closest SPs might
             prove to be <B>not good enough</B>, like being too far, or being on
             the other hemisphere f.ex.
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             See here an example of a bad SPs distribution (on the left), with SPs
             missing in the occipital and frontal parts, and a better distribution
             (on the right), without holes and with a fuller coverage:
         </P>
         <P>
             <IMG SRC="images/cris.sp-bad-example-2.png" VSPACE="0" HSPACE="0" BORDER="0"><IMG SRC="images/cris.sp-good-example-2.png" VSPACE="0" HSPACE="0" BORDER="0">
         </P>
         <P>
             &nbsp;
         </P>
         <H4>
             <A NAME="SPs-number"></A>Number of SPs
         </H4>
         <P>
             Choosing the number of SPs is up to the user, with a recommended
             range from <B>3000 to 6000</B>, and a default set to <B>6000</B>.
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             There are pros and cons for both low and high number of SPs, some
             being more or less obvious:
         </P>
         <P>
             <TABLE WIDTH="80%" CELLPADDING="2" CELLSPACING="0" BORDER="1">
                 <TR>
                     <TD WIDTH="50%" VALIGN=TOP>
                         <UL>
                             <P>
                                 <B>Lower number of SPs</B>
                     </TD>
                     <TD WIDTH="50%" VALIGN=TOP>
                         <UL>
                             <P>
                                 <B>Higher number of SPs</B>
                     </TD>
                 </TR>
                 <TR>
                     <TD WIDTH="50%" VALIGN=TOP>
                         <P>
                             <B>(+)</B> Faster to compute the matrices
                         </P>
                         <P>
                             <B>(+)</B> Less memory
                         </P>
                         <P>
                             <B>(+)</B> Less numerical precision issues
                         </P>
                         <P>
                             <B>(+)</B> Smaller matrices &amp; Faster display
                     </TD>
                     <TD WIDTH="50%" VALIGN=TOP>
                         <P>
                             <B>(-)</B> Longer to compute the matrices
                         </P>
                         <P>
                             <B>(-)</B> More memory
                         </P>
                         <P>
                             <B>(-)</B> More numerical precision issues
                         </P>
                         <P>
                             <B>(-)</B> Bigger matrices &amp; Slower display
                     </TD>
                 </TR>
                 <TR>
                     <TD WIDTH="50%" VALIGN=TOP>
                         <P>
                             <B>(-)</B> Less spatial resolution
                         </P>
                         <P>
                             <B>(-)</B> Less spatial accuracy
                         </P>
                         <P>
                             <B>(-)</B> Less neighbors around each SPs
                     </TD>
                     <TD WIDTH="50%" VALIGN=TOP>
                         <P>
                             <B>(+)</B> More spatial resolution
                         </P>
                         <P>
                             <B>(+)</B> <I>Somehow</I> more spatial accuracy
                         </P>
                         <P>
                             <B>(+)</B> More neighbors around each SPs
                     </TD>
                 </TR>
             </TABLE>
         </P>
         <P>
             &nbsp;
         </P>
         <UL>
             <LI CLASS="mvd-P">
                 <P>
                     <B>Speed</B> is only a slight annoyment. If you are in a hurry for
                     some reasons, use something like 3000 SPs. Otherwise, run it during a
                     break, 5000 SPs and 257 electrodes should be done in about 10 minutes
                     per matrix, 6000 SPs in about 30 minutes.
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     <B>Memory</B> issue is a real problem. If you encounter some
                     problems, make sure your machine has enough of physical memory, is
                     healthy and set correctly. If the problems remain, try to reduce
                     the number of SPs, from 5000 down to 3000.
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     <B>Numerical precision</B> issues come from the fact that inverting
                     huge matrices will cumulate more errors than for smaller ones.
                     However, this shouldn't be a real problem here, and nothing can be
                     really done about that in the realm of digital computers.
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     <B>Bigger matrices</B> shouldn't be a real concern with our current
                     storage capacity. However, a higher number of SPs can be slightly
                     detrimental to the speed of the <A HREF="esi-display.html">inverse display</A>,
                     as there are more rows to compute from the inverse matrix.
                 </P>
                 <P>
                     &nbsp;
                 </P>
                 <P>
                     Now, about the sensitive topics of <B>spatial resolution</B> (grid
                     spacing) and <B>accuracy</B> (to be spot-on). If first recommend you
                     to get an idea of <A HREF="https://www.google.ch/search?q=resolution+accuracy+precision">
                         <B>
                             what
                             these terms really mean
                         </B>
                     </A>.
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     <B>More points</B> means <B>more spatial resolution</B>, <B>always</B>,
                     as the resulting grid spacing will be smaller.
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     <B>More points</B> also means <B>more accuracy</B>, but <B>up to a limit</B>.
                     First, <B>accuracy can not be better than the resolution</B>. So you <I>have</I>
                     to increase the number of points to also increase the accuracy. But <B>
                         accuracy
                         will stop improving
                     </B> past a given number of SPs (i.e. the inverse
                     solution is not &quot;getting better&quot;), somehow due to the fact
                     that the quantity of information inputted into the system remains the
                     same, and is set by the number of electrodes. Also, the matrix
                     inversion process can intrinsically provide only a given level of accuracy.
                 </P>
                 <P>
                     To summarize, from our experience, the range 3000 to 6000 SPs seems
                     correct for regular adult human brains.
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     As said earlier, there needs to be <A HREF="#SPs-neighborhood">
                         <B>
                             enough
                             neighbors around each SP
                         </B>
                     </A>. And the more SPs, the more
                     neighbors there are for each SP. Again, 3000 looks like a minimum
                     value here.
                 </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <H4>
             <A NAME="SPs-results"></A>SPs Results
         </H4>
         <P>
             When computing the Solution Points, you'll have the following results:
         </P>
         <UL>
             <LI CLASS="mvd-P">
                 <P>
                     <A HREF="#grey-mask">A Grey Mask file,</A>
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     A Solution Points file, output format is <I><B><A HREF="files-formats-cartool.html#spi">.spi</A></B></I>.
                 </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <P>
             Some remarks about the output of the Solution Points extraction:
         </P>
         <UL>
             <LI CLASS="mvd-P">
                 <P>
                     Points are <B>regularly spaced</B> on a grid, but <B>may not be aligned</B>
                     on MRI's voxels nor X/Y/Z axis.
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     SPs are <B>named</B> according to which <B>octant</B> they belong to:
                 </P>
                 <UL>
                     <LI CLASS="mvd-P">
                         <P>
                             First, <B>3 letters</B> within <B>L</B>eft/<B>R</B>ight, <B>P</B>osterior/<B>A</B>nterior
                             and <B>I</B>nferior/<B>S</B>uperior
                         </P>
                         <P>
                             (like in &quot;LAS&quot; for the Left Anterior Superior),
                         </P>
                     <LI CLASS="mvd-P">
                         <P>
                             Followed by a <B>number</B> within that particular octant
                         </P>
                         <P>
                             (like in &quot;LAS123&quot; for the 123<SUP>th</SUP> point).
                         </P>
                 </UL>
         </UL>
         <P>
             &nbsp;
         </P>
         <P>
             See this paragraph about <A HREF="#combining-sps-and-lf">
                 all
                 combinations of Solution Points / Lead Field options
             </A>.
         </P>
         <P>
             &nbsp;
         </P>
         <H3>
             <A NAME="loading-sps"></A>Loading Solution Points
         </H3>
         <P>
             <B><I>Use this option with care</I></B>, Cartool will load your file
             &quot;as is&quot;, so it better had to have these properties:
         </P>
         <UL>
             <LI CLASS="mvd-P">
                 <P>
                     It should be in the <B>
                         same space as the MRI Head / Brain /
                         Electrodes XYZ
                     </B>;
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     It should be <B>topologically fit</B> for the <A HREF="#inverse-solution">
                         inversion
                         step
                     </A>:
                 </P>
                 <UL>
                     <LI CLASS="mvd-P">
                         <P>
                             Points should be <B>inside&nbsp; the brain</B>, and preferably in the <B>
                                 grey
                                 matter
                             </B> (though having points in the white matter is no big
                             deal). However, points <I>outside</I> the brain will certainly
                             produce an erroneous Lead Field and inverse matrix.
                         </P>
                     <LI CLASS="mvd-P">
                         <P>
                             Points should be aligned on a <B>grid</B>, but this grid is <I>not</I>
                             required to be aligned on the X/Y/Z axis, nor to land exactly on the
                             MRI voxels center.
                         </P>
                     <LI CLASS="mvd-P">
                         <P>
                             Each point should have at least a <B>few neighbors (at least 1!)</B>,
                             to be able to compute some neighborhood constraints, like a Laplacian.
                         </P>
                     <LI CLASS="mvd-P">
                         <P>
                             <B><A HREF="#SPs-distribution">Left-right distribution should be balanced</A></B>
                             and reflect the actual distribution of the grey matter, especially
                             near the mid-sagittal cutting plane. If the points are not
                             symetrically distributed, some locations will be missing and the
                             Laplacian will not be correct, too.
                         </P>
                 </UL>
         </UL>
         <P>
             &nbsp;
         </P>
         <P>
             Loading a Solution Points file is of interest if you want to compare
             different Lead Fields, while keeping the inverse space constant.
         </P>
         <P>
             Also, see this paragraph about <A HREF="#combining-sps-and-lf">
                 all
                 combinations of Solution Points / Lead Field options
             </A>.
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             Here is an example of re-loading a qualified <A HREF="#SPs-extraction">
                 Cartool-computed
                 solution space
             </A>, on top of the brain:
         </P>
         <UL>
             <P>
                 <IMG SRC="images/cris.sp-loading-on-brain.png" VSPACE="0" HSPACE="0" BORDER="0">
             </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <P>
             And here is an example of re-loading a <A HREF="#SPs-extraction">
                 Cartool-computed
                 solution space
             </A>, on top of an <A HREF="#lead-field-loading">
                 existing
                 Lead Field
             </A> (a typical case for <A HREF="#lead-field-interpol">
                 Lead
                 Field interpolation
             </A>):
         </P>
         <UL>
             <P>
                 <IMG SRC="images/cris.sp-loading-on-other-sp.png" VSPACE="0" HSPACE="0" BORDER="0">
             </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <H3>
             <A NAME="same-sp-as-lf"></A>Same Solution Points as Lead Field
         </H3>
         <P>
             If you are <A HREF="#lead-field-loading">reloading a Lead Field</A>,
             with its <A HREF="#lead-field-inputfil">associated Solution Points file</A>,
             you can simply tell Cartool to use it as the output solution space.
         </P>
         <P>
             In case the amount of Solution Points is too high, you can
             (approximately) <B>downsample the solution space</B> and the <B>
                 <A HREF="#lead-field-downsamp">
                     Lead
                     Field
                 </A>
             </B> to a given number of points.
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             Also, see this paragraph about <A HREF="#combining-sps-and-lf">
                 all
                 combinations of Solution Points / Lead Field options
             </A>.
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             See here an example of (heavy) downsampling, from 150'000 points to
             about 3'000:
         </P>
         <UL>
             <P>
                 <IMG SRC="images/cris.sp-downsampling.png" VSPACE="0" HSPACE="0" BORDER="0">
             </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <H2>
             <A NAME="lead-field-comput"></A>Lead Field processing
         </H2>
         <P>
             &nbsp;
         </P>
         <H5>
             <A HREF="#lead-field-what-is">What is the Lead Field</A><br>
             <A HREF="#lead-field-input">Lead Field input</A><br>
             <A HREF="#lead-field-comp-det">Lead Field computation</A>
         </H5>
         <UL>
             <H5>
                 <A HREF="#lsmac-model">LSMAC geometrical model</A>
             </H5>
             <UL>
                 <H5>
                     <A HREF="#lsmac-processing">Spherization step</A><br>
                     <A HREF="#lsmac-spherization">Spherization function</A>
                 </H5>
             </UL>
             <H5>
                 <A HREF="#skull-from-mri">Skull &amp; CSF thicknesses from MRI</A>
             </H5>
             <UL>
                 <H5>
                     <A HREF="#skull-per-electrode">Skull estimation for each electrode</A><br>
                     <A HREF="#skull-results">Layers estimates output</A>
                 </H5>
             </UL>
         </UL>
         <UL>
             <H5>
                 <A HREF="#skull-age-to-thickness">Age to skull thickness</A><br>
                 <A HREF="#skull-age-to-conductivity">Age to skull &amp; other conductivities</A><br>
                 <A HREF="#electromagnetic-equations">
                     E<span class="auto-style10">
                         lectromagnetic
                         equations
                     </span>
                 </A>
             </H5>
             <UL>
                 <H5>
                     <A HREF="#Ary-approximation">A<span class="auto-style10">ry approximation</span></A><br>
                     <A HREF="#exact-equations">
                         E<span class="auto-style10">
                             xact analytic
                             equations
                         </span>
                     </A>
                 </H5>
             </UL>
         </UL>
         <H5>
             <A HREF="#lead-field-loading">Loading the Lead Field from file</A>
         </H5>
         <UL>
             <H5>
                 <A HREF="#lead-field-inputfil">Loading Lead Field - Input files</A>
             </H5>
         </UL>
         <H5>
             <A HREF="#lead-field-results">Lead Field results</A>
         </H5>
         <P>
             &nbsp;
         </P>
         <H3>
             <A NAME="lead-field-what-is"></A>What is the Lead Field (LF)
         </H3>
         <P>
             The <B>Lead Field <I>K</I></B> (sometimes called the Forward Solution
             as opposed to the Inverse Solution) is a <B>matrix</B> that embodies
             the <B>physical relations</B> that exist between the <B>
                 current
                 sources in the brain
             </B> and the <B>electrical potentials on the surface</B>,
             as picked up by the electrodes. It is made up of:
         </P>
         <ul>
             <li>
                 &nbsp;the <strong>
                     geometrical relationship between the solution points
                     and the electrodes
                 </strong>, i.e. how far and at which angles they lie
                 respectively;
             </li>
             <li>
                 and <strong>electromagnetic laws</strong>, i.e. how the
                 electromagnetic field propagates through different media, and the
                 resulting voltage on a receiving electrode.
             </li>
         </ul>
         <P>
             This matrix is used at the core of the <A HREF="#inverse-solution">
                 Inverse
                 Solution
             </A>, and the accuracy of its construction will be directly
             reflected in the inverse solutions. See here an example of how one
             frontal electrode (yellow) will get most of its potentials from solution points which
             dipoles align with the red vectors:
         </P>
         <P>
             <IMG SRC="images/cris.lf-example-1.png" VSPACE="0" HSPACE="0" BORDER="0">
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             There is certainly a <B>trade-off</B> between the <B>complexity</B>
             of the model, the <B>amount of parameters</B> to know and adjust, the <B>time</B>
             and <B>ease to compute it</B>, and its <B>effectiveness</B> in the
             whole Inverse Solutions scheme. For sure, the more realistic and the
             more parameters there are, the better the model should be. But there
             are also practical issues, like the speed of computation, the reliability of
             the results, the real
             contribution of a more complex model as compared to a simpler one. Last but
             not least, not all physical parameters (like the
             <A HREF="#skull-age-to-conductivity">
                 skull
                 conductivity
             </A>) are well known for the moment.
         </P>
         <P>
             &nbsp;
         </P>
         <H3>
             <A NAME="lead-field-input"></A>Lead Field input
         </H3>
         <P>
             To actually <B><A HREF="#lead-field-comp-det">compute</A></B> the
             Lead Field in Cartool, you only need:
         </P>
         <UL>
             <LI CLASS="mvd-P">
                 <P>
                     The <B><A HREF="#electrodes-setup">electrodes</A></B>, <A HREF="#electrodes-coreg">
                         coregistered
                         to the MRI Head
                     </A>;
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     The <A HREF="#solution-space"><B>Solution Points</B></A>, also in the
                     MRI space.
                 </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <P>
             Or you can otherwise <B><A HREF="#lead-field-loading">reload</A></B>
             an existing LF, in which case you need:
         </P>
         <UL>
             <LI CLASS="mvd-P">
                 <P>
                     The <A HREF="#lead-field-inputfil">Lead Field file</A> (a matrix),
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     Its associated <A HREF="#lead-field-inputfil">Solution Points file</A>
                     (list of points).
                 </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <H3>
             <A NAME="lead-field-comp-det"></A>Lead Field computation
         </H3>
         <P>
             Computing the Lead Field can be split into a <strong>geometrical part</strong>,
             and an <strong>electromagnetic part</strong>:
         </P>
         <UL>
             <LI CLASS="mvd-P">
                 <P>
                     The only geometrical model currently available is the <A HREF="#lsmac-model"> <B>LSMAC</B> model</A> (Locally
                     Spherical Model with Anatomical Constraints), which is very close to a BEM
                     model. Note that the older <strong>SMAC</strong> model has been retired;
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     <A HREF="#skull-from-mri">Tissues thicknesses are then estimated </A>from
                     the MRI
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     <A HREF="#skull-age-to-conductivity">
                         Tissues conductivities are also
                         estimated
                     </A> from a table
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     The <A HREF="#electromagnetic-equations">electromagnetic model</A> could then be:
                 </P>
                 <UL>
                     <LI CLASS="mvd-P">
                         <P><strong><A HREF="#Ary-approximation">3-Shell model + Ary approximation</A></strong> (older)</P>
                     <LI CLASS="mvd-P">
                         <P>
                             <strong><A HREF="#exact-equations">3-Shell model + exact equations</A> </strong>(for
                             testing purposes)
                         </P>
                     <LI CLASS="mvd-P">
                         <P><strong><A HREF="#exact-equations">4-Shell model + exact equations</A> </strong>(recommended)</P>
                     <LI CLASS="mvd-P">
                         <P>
                             <strong><A HREF="#exact-equations">6-Shell model + exact equations</A> </strong>(also
                             recommended)
                         </P>
                 </UL>
             <LI CLASS="mvd-P">
                 <P>
                     <B><A HREF="#lead-field-loading">Loading your own LF</A></B>, either from a previous Cartool computation, or
                     from another package.
                 </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <P>
             You can also visit this paragraph about <A HREF="#combining-sps-and-lf">
                 all
                 combinations of Solution Points / Lead Field options
             </A>.
         </P>
         <P>
             &nbsp;
         </P>
         <H4>
             <A NAME="lsmac-model"></A>LSMAC geometrical model
         </H4>
         <P>
             The <strong>LSMAC geometrical model</strong> is basically a way to transform
             the real head shape into some <strong>intermediate local spherical model</strong>.
             Because it is done with different parameters for each electrode position, it
             preserves many of the original head properties, like local thicknesses.
         </P>
         <P>
             Also note that this step is totally independent to the electromagnetic model
             and its number of layers.
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             Here we can see f.ex. how the spherical parameters will be different for
             different 2 electrodes (in yellow):
         </P>
         <P>
             <IMG SRC="images/cris.lf-lsmac-radiuses.png" VSPACE="0" HSPACE="0" BORDER="0">
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             See the article for an introduction to the method:<BR>
             &nbsp;
         </P><PRE><B>&quot;Spatiotemporal Analysis of Multichannel EEG: CARTOOL&quot;</B>,<BR>Denis Brunet, Micah M. Murray, Christoph M. Michel,<BR><I>Computational Intelligence and Neuroscience</I>, 2011.</PRE><P>
             The idea is to push the spherical model to the limit of its
             capabilities, while keeping the benefits of its equations (relative!)
             simplicity. It can be thought of a sort of BEM model, as it
             approximates the boundaries of the brain and skull.
         </P>
         <P>
             &nbsp;
         </P>
         <UL>
             <H4>
                 <A NAME="lsmac-processing"></A>LSMAC Spherization step
             </H4>
         </UL>
         <P>
             The LSMAC processing pipe-line is very similar to the older (and obsolete) SMAC model:
         </P>
         <H5>
             &nbsp;
         </H5>
         <H5>
             MRIs &amp; Electrodes -&gt; Extract Gey mask &amp; Solution Points,
             Compute Laplacian -&gt; Compute Scalp / Skull / CSF / Brain radii &amp; Spherical
             Model, for each
             electrode -&gt; Compute LF
         </H5>
         <P>
             &nbsp;
         </P>
         <P>
             It is important to note that a <strong>
                 spherical model
                 is computed underneath each electrode
             </strong>, so the global model accounts
             for the real scalp / skull / CSF / brain radii, as a BEM model would.
         </P>
         <P>
             &nbsp;
         </P>
         <UL>
             <H4>
                 <A NAME="lsmac-spherization"></A>LSMAC Spherization function
             </H4>
         </UL>
         <P>
             A global spherization model is computed by fitting a parametric model to the
             scalp. It is then used to convert the head to a sphere, with internal skull,
             CSF and brain boundaries adjusted for each electrode.
         </P>
         <P>
             See here the spherization sequence done in Cartool, showing: the full
             MRI fitted with a scalp model, and how the model warps into a sphere.
         </P>
         <P>
             <IMG SRC="images/cris.lf-smac-1.png" VSPACE="0" HSPACE="0" BORDER="0"><IMG SRC="images/cris.lf-smac-2.png" VSPACE="0" HSPACE="0" BORDER="0"><IMG SRC="images/cris.lf-smac-3.png" VSPACE="0" HSPACE="0" BORDER="0"><BR>
             <IMG SRC="images/cris.lf-smac-4.png" VSPACE="0" HSPACE="0" BORDER="0"><IMG SRC="images/cris.lf-smac-5.png" VSPACE="0" HSPACE="0" BORDER="0">
         </P>
         <P>
             &nbsp;
         </P>
         <H4>
             <A NAME="skull-from-mri"></A>Tissues boundaries estimated from MRI
         </H4>
         <P>
             The <A HREF="#electromagnetic-equations">electromagnetic models</A> will need
             to know the boundaries of either 3 or 4 of the following layers: scalp,
             skull, CSF and brain layers. When only 3 layers are actually needed, then the brain and CSF
             will be merged into as a single layer with
             weighted average conductivity.
         </P>
         <P>
             When this option is checked,
             Cartool will <a href="#lsmac-model">estimate the radii</a>
             of the skull, CSF and brain under each electrode from the provided T1 MRI.
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             Note that in case the skull has been operated and still has some open holes in it, you might
             want to switch off this option by using one of the Lead Field Preset. In this case, predefined,
             constant radii will be used in the model. Of course, this should be used only
             as a last resort...
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             Also note that scanning through a T1 MRI is quite a difficult task, and will
             essentially provide <em>relative thicknesses</em>. To recalibrate these <em>
                 relative thicknesses
             </em> into <em>absolute thicknesses</em>, Cartool will
             use the <A HREF="#skull-age-to-thickness">table shown below</A>.
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             Here is an example of the 4-Shell surfaces extracted from the T1 MRI (left),
             and a close-up to 4 electrodes with their corresponding positions shown at
             each layer underneath (right):
         </P>
         <P>
             <img SRC="images/cris.4-shell-estimation.2.png"><img height="315" SRC="images/cris.4-shell-estimation.1.png" width="303">
         </P>
         <P>
         </P>
         <UL>
             <H4>
                 <A NAME="skull-per-electrode"></A>Skull estimation for each electrode
             </H4>
         </UL>
         <P>
             For the Lead Field computation, Cartool needs only the skull
             information <B>below each electrode</B> locus, and <I>not</I> for the
             entire head.
         </P>
         <P>
             To do so, Cartool extracts a <B>radial sample</B>, from the electrode
             position to the <A HREF="#mris-origin">geometrical center</A>, looks
             for a type of <B>valley pattern</B> in the intensity levels near the
             expected bone, and takes the edges of this valley as the skull boundaries.
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             See here an example of the relative radii of the inner and outer
             parts of the skull, for 257 electrodes, some of which being on the
             cheek and near the neck (100% corresponds to the electrode distance):
         </P>
         <P>
             <IMG SRC="images/cris.skull-radiuses.png" VSPACE="0" HSPACE="0" BORDER="0">
         </P>
         <P>
             This example shows clearly the advantage of adapting the
             scalp/skull/brain radii according to each electrode, as the inner
             skull radii vary from 35% to 85%, and the outer part from 42% to 92%.
         </P>
         <P>
             &nbsp;
         </P>
         <UL>
             <H4>
                 <A NAME="skull-results"></A>Layers estimates output
             </H4>
         </UL>
         <P>
             Some remarks about the output of the Skull estimation:
         </P>
         <UL>
             <LI CLASS="mvd-P">
                 <P>
                     There should be 4 files:<br><I>
                         <B>
                             <A HREF="files-formats-cartool.html#xyz">
                                 *.Boundary
                                 1.CSF Inner Surface.xyz
                             </A>
                         </B>
                     </I><br><I>
                         <B>
                             <A HREF="files-formats-cartool.html#xyz">
                                 *.Boundary
                                 1.Skull Inner Surface.xyz
                             </A>
                         </B>
                     </I><br><I>
                         <B>
                             <A HREF="files-formats-cartool.html#xyz">
                                 *.Boundary
                                 2.Skull Outer
                                 Surface.xyz
                             </A>
                         </B>
                     </I>&nbsp;and<br><I>
                         <B>
                             <A HREF="files-formats-cartool.html#xyz">
                                 *.Boundary
                                 3.Scalp Outer Surface.xyz
                             </A>
                         </B>
                     </I><br>in the &quot;More&quot;
                     directory, which contain the 4 layers boundary estimated for each electrodes.
                 </P>
                 <P>
                     You can superimposed them to the full head to check each surface and each
                     electrode radii.
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     The <B><I><A HREF="files-formats-cartool.html#vrb">.vrb</A></I></B> verbose file will
                     contain a full table of the absolute and relative radii of each layer and
                     for each electrode.
                 </P>
         </UL>
         <P>
         </P>
         <H4>
             <A NAME="skull-from-tissues-file"></A>Tissues boundaries computed from
             segmented tissues file
         </H4>
         <P>
             Better than estimating the <A HREF="#skull-from-mri">
                 boundaries from the T1
                 MRI
             </A>, user can provide a volume with each voxel labeled as a given tissue
             index.
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             Example of a segmented tissues file (MNI):
         </P>
         <P class="auto-style1">
             <img height="445" src="images/cris.tissues.2.png" width="611">
         </P>
         <P>
         </P>
         <P>
             Tissues indexes are stored in the associated <strong>&lt;same file name&gt;.txt</strong> file, and is currently
             accounting for 14 different tissues:
         </P>
         <pre>1 Scalp
2 Fat
3 Muscle
4 CSF
5 Blood
6 Eye
7 Air
8 Skull
9 SkullCompact
10 SkullSpongy
11 SkullSuture
12 Brain
13 Grey
14 White</pre>
         <p></p>
         <P class="mvd-h4">
             <A NAME="skull-age-to-thickness"></A>Age to skull thickness
         </P>
         <P>
             The skull goes through a lot of changes across age, especially from newborn
             up to 17 years old. Its thickness increases over the time, while its relative
             conductivity to an electromagnetic signal also decreases.
         </P>
         <P>
             Unfortunately, both thickness and relative conductivity are needed to
             <A HREF="#lsmac-model">compute a reliable the Lead Field</A>. To increase
             the confidence in the model, the user has now to specify the targeted age for
             its inverse solution. Cartool then uses two tables to convert the age to mean
             thickness and age to conductivity, then updates these two fields in the
             dialog.
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             Here is the age to thickness curve, with age ranging from birth to 100 years,
             and thickness in [mm]:
         </P>
         <P class="auto-style1">
             <img alt="Age to skull thickness" height="273" SRC="images/cris.skull-age-to-thickness.png" width="482">
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             This curve was built from these 2 data sets, the first one on 0 to 20 yo, the
             second above 20 yo:
         </P>
         <P class="mvd-pre">
             <strong>&quot;Increase in cranial thickness during growth,&quot;<br></strong>
             A. F. Roche, ,<br><em>Hum. Biol.</em>,
             vol. 25, pp. 81-92, May 1953.<br><br><br><strong>
                 &quot;Evaluation of Skull Cortical Thickness
                 Changes With Age and Sex From Computed Tomography Scans&quot;,<br>
             </strong>E.
             M. Lillie, J. E. Urban, S. K. Lynch, A. A. Weaver, and J. D. Stitzel,<br><em>J. Bone Miner. Res.</em>,
             vol. 31, pp. 299-307, Feb 2016.
         </P>
         <P>
             Note that Cartool first estimate the <A HREF="#skull-from-mri">
                 skull from the
                 T1
             </A>. Then it adjusts the global thickness according to the curve above.
             This could be taken advantage of, f.ex. if one only has an adult template at
             hand, but still needs an inverse for some younger individuals. By using the
             adult template, and forcing the mean thickness to be thinner, user can
             achieve a better estimate of the Lead Field (also, templates for all sorts of
             age exist nowadays).
         </P>
         <P class="mvd-h4">
             <A NAME="skull-age-to-conductivity"></A>Age to skull &amp; other conductivities
         </P>
         <P>
             There is a field to specify the <strong>absolute conductivity</strong> of the skull,
             in [S/m]. Also see the
             paragraph above about <A HREF="#skull-age-to-thickness">skull thickness</A>.
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             It is usually automatically set from the following age to conductivity curve
             (unit in [S/m]), with age ranging from birth
             to 100 years:
         </P>
         <P class="auto-style1">
             <img alt="Age to skull conductivity" height="400" SRC="images/cris.skull-age-to-conductivity.png" width="498">
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             The other tissues conductivities have been set to (using the McCann reference
             below, but may change in the future):
         </P>
         <P>
             &nbsp;
         </P>
         <table cellpadding="3" cellspacing="0" class="auto-style11" style="width: 400">
             <tr>
                 <th class="auto-style12" style="width: 50%"><strong>Tissue</strong></th>
                 <th class="auto-style12" style="width: 50%">
                     <strong>
                         Conductivity, in
                         [S/m]
                     </strong>
                 </th>
             </tr>
             <tr>
                 <td class="auto-style12" style="width: 50%">White Matter</td>
                 <td class="auto-style12" style="width: 50%">0.1462</td>
             </tr>
             <tr>
                 <td class="auto-style12" style="width: 50%">Grey Matter</td>
                 <td class="auto-style12" style="width: 50%">0.3787</td>
             </tr>
             <tr>
                 <td class="auto-style12" style="width: 50%">Blood</td>
                 <td class="auto-style12" style="width: 50%">0.5737</td>
             </tr>
             <tr>
                 <td class="auto-style12" style="width: 50%">CSF</td>
                 <td class="auto-style12" style="width: 50%">1.7358</td>
             </tr>
             <tr>
                 <td class="auto-style12" style="width: 50%">Scalp</td>
                 <td class="auto-style12" style="width: 50%">0.4137</td>
             </tr>
         </table>
         <P>
             &nbsp;
         </P>
         <P>
             Literature is very scarse on the estimation of the live skull conductivity.
             Old numbers were estimated from cadavers, and were proven to be way to low as
             to live ones. Herer are the references that have been used:
         </P>
         <P class="mvd-pre">
             <strong>
                 &quot;Variation in reported human head tissue electrical
                 conductivity values&quot;,<br>
             </strong>H. McCann, G. Pisano, L.&nbsp; Beltrachini,<br>
             <em>Brain Topography</em>, 2019 &amp; 2021<br><br><br><strong>
                 &quot;Measurement of the conductivity of skull,
                 temporarily removed during epilepsy surgery&quot;,<br>
             </strong>R. Hoekema, G.
             H. Wieneke, F. S. Leijten, C. W. van Veelen, P. C. van Rijen, G. J. Huiskamp,
             et al.,<br><em>Brain Topogr.</em>, vol. 16, pp.
             29-38, Fall 2003.
         </P>
         <P>
             &nbsp;
         </P>
         <P class="mvd-h4">
             <A NAME="electromagnetic-equations"></A>Electromagnetic equations
         </P>
         <P>
             Once assumed within a <A HREF="#lsmac-model">(local) spherical model</A>, the
             <A HREF="#skull-from-mri">tissues thicknesses</A> and
             <A HREF="#skull-age-to-conductivity">conductivities estimated</A>, Cartool
             can proceed with the electromagnetic models, with the following optinos
             available:
         </P>
         <ul>
             <li>
                 The old <strong>
                     <A HREF="#Ary-approximation">
                         Ary approximation
                         for 3-Shell model
                     </A>
                 </strong> (obsolete)
             </li>
             <li>
                 The new <strong>
                     <A HREF="#exact-equations">
                         exact analytic equations
                         for 3-Shell, 4-Shell or 6-Shell models
                     </A>
                 </strong>
             </li>
         </ul>
         <P>
         </P>
         <h4 class="auto-style1">
             <A NAME="Ary-approximation"></A>Ary approximation
         </h4>
         <P>
             <em>Note:</em> this model is obsolete and is still there for backward
             compatibility only. Use the more precise <A HREF="#exact-equations">
                 exact
                 equations below
             </A>.
         </P>
         <P>
             For the old <strong>Ary, isotropic 3-Shell model</strong> (only), Cartool uses an <strong>
                 approximation to the exact analytic solutions
             </strong> to the electromagnetic
             equations.
         </P>
         <P>
             It essentially replaces a dipole in a 3-Shell model by an equivalent dipole
             in a 1-Shell model, which equations are much easier to compute. The
             equivalent dipole is the original dipole, but shifted a little deeper into
             the brain. The radii ratio between the original and shifted dipoles will
             depend on the relative conductivities of the skull to the ( scalp + brain +
             CSF ) layers, among many things.
         </P>
         <P>
             There also exist improvements to this method, f.ex. by Scherg &amp; Berg, or Zhi
             Zhang.
         </P>
         <P>
             This Ary method has been the one in used since the early days of Cartool, and
             has proven to be quite robust.
         </P>
         <P>
             <br>
         </P>
         <P>
             Reference:
         </P><PRE><B>&quot;Location of Sources of Evoked Scalp Potentials: Corrections for Skull and Scalp Thicknesses&quot;</B>,<BR>James P. Ary, Stanley A. Klein, Derek H. Fender,<BR><I>Biomedical Engineering</I>, Vol. BME-28, No6, June 1981.<BR> 
         <BR><B>Niedermeyer's Electroencephalography</B>, chapter 55 <B>&quot;EEG Mapping and Source Imaging&quot;</B>,<BR>Chr. Michel, B. He,<BR><I>Lippincott Williams &amp; Wilkins</I>, 2010.<BR> 
         <BR><B>Electrical Neuroimaging</B>,<BR>Chr. Michel, Th. Koenig, D. Brandeis, L.R.R. Gianotti and J. Wackermann,<BR><I>Cambridge University Press</I>, 2009.</PRE>
         <P>
         </P>
         <h4 class="auto-style1">
             <A NAME="exact-equations"></A>Exact analytic equations
         </h4>
         <P>
             The <strong>
                 full, exact, analytic solutions equations for any number of
                 isotropic layers
             </strong> has been implemented since 2021. It is currently used for
             <strong>3-Shell model</strong>,
             <strong>4-Shell model and 6-Shell models</strong>:
         </P>
         <ul>
             <li>3-Shell model is made of brain, skull and scalp layers;</li>
             <li>4-Shell model is made of brain, CSF, skull and scalp layers;</li>
             <li>
                 6-Shell model is made of brain, CSF, skull compact, skull spongy,
                 skull compact and scalp layers.
             </li>
         </ul>
         <P>
             &nbsp;
         </P>
         <P>
             This one <strong>does not make use of any approximations</strong>, for the
             spherical case. It gives the <strong>
                 exact
                 potential from the exact (spherical) positions of both the solution point and the
                 electrode, and through any number of isotropic spherical layers
             </strong>. It is therefore
             logically expected to give better
             results than the Ary 3-Shell approximation. Although it involves two double recursive
             Lagrange
             formulas, its implementation runs pretty fast anyway.
         </P>
         <P>
             <br>
         </P>
         <P>
             The formulas for the 4-Shell model can be found in (note there is an
             error in the general formula, corrected in Nunez &amp; Srinivasan book):
         </P><PRE><B>&quot;A fast method to compute surface potentials generated by dipoles within multilayer anisotropic spheres&quot;,
Zhi Zhang,
</B><em>Phys. Med. Biol.</em> 40, 1995.
 
 
<strong>&quot;Electric Fields of the Brain - The Neurophysics of the EEG&quot;</strong>,
Paul L. Nunez, Ramesh Srinivasan,
<em>Oxford University Press</em>, 2nd Ed. 2006.</PRE>
         <P>
             &nbsp;
         </P>
         <H3>
             <A NAME="lead-field-loading"></A>Loading the Lead Field from file
         </H3>
         <P>
             The Lead Field (aka Forward model) can be reloaded from an <B>
                 external
                 file
             </B>. The main reasons could be:
         </P>
         <UL>
             <LI CLASS="mvd-P">
                 <P>
                     You computed a LF with <B>another model</B> (like a BEM or FEM), and want to plug it into the inversion step of Cartool,
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     Or you just want to re-use the LF computed by an <B>earlier run of Cartool</B>,
                     hence saving time.
                 </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <P>
             See this paragraph about <A HREF="#combining-sps-and-lf">
                 all
                 combinations of Solution Points / Lead Field options
             </A>.
         </P>
         <P>
             &nbsp;
         </P>
         <H4>
             <A NAME="lead-field-inputfil"></A>Loading Lead Field - Input files
         </H4>
         <P>
             You need two input files:
         </P>
         <UL>
             <LI CLASS="mvd-P">
                 <P>
                     The <B><A HREF="#lead-field-what-is">Lead Field</A> matrix</B> file,
                     which can be any of the <A HREF="files-formats-others.html#inverse-solutions">
                         following
                         format
                     </A>:
                 </P>
                 <UL>
                     <LI CLASS="mvd-P">
                         <P>
                             <B><I><A HREF="files-formats-cartool.html#lf">.lf</A></I></B><A HREF="files-formats-cartool.html#lf">&nbsp;</A>
                             from Cartool (and an older SMAC Toolbox)
                         </P>
                     <LI CLASS="mvd-P">
                         <P>
                             <B><I><A HREF="files-formats-cartool.html#ris">.ris</A></I></B> from Cartool
                         </P>
                     <LI CLASS="mvd-P">
                         <P>
                             <B><I><A HREF="files-formats-others.html#inverse-solutions">.lft</A></I></B>&nbsp;
                             from the Besa Toolbox
                         </P>
                     <LI CLASS="mvd-P">
                         <P>
                             <strong><em>.csv</em></strong> file
                         </P>
                 </UL>
             <LI CLASS="mvd-P">
                 <P>
                     Its associated <A HREF="#SPs-extraction"><B>Solution Points</B></A>
                     file, which can be any of the <A HREF="files-formats-others.html#solution-points">
                         following
                         format
                     </A>:
                 </P>
                 <UL>
                     <LI CLASS="mvd-P">
                         <P>
                             <B><I><A HREF="files-formats-cartool.html#spi">.spi</A></I></B> from Cartool
                         </P>
                     <LI CLASS="mvd-P">
                         <P>
                             <B><I><A HREF="files-formats-others.html#solution-points">.loc</A></I></B>
                             from the Besa Toolbox
                         </P>
                     <LI CLASS="mvd-P">
                         <P>
                             <B><I><A HREF="files-formats-others.html#solution-points">.sxyz</A></I></B>
                             from the Loreta Toolbox
                         </P>
                 </UL>
         </UL>
         <P>
             &nbsp;
         </P>
         <H3>
             <A NAME="lead-field-results"></A>Lead Field results
         </H3>
         <P>
             Only if you have <A HREF="#lead-field-comp-det">computed the LF</A>,
             you'll have the following results:
         </P>
         <UL>
             <LI CLASS="mvd-P">
                 <P>
                     <A HREF="#skull-results">Some boundary files,</A>
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     The&nbsp; <B><I><A HREF="files-formats-cartool.html#lf">.lf</A></I></B><A HREF="files-formats-cartool.html#lf">&nbsp;</A>
                     Lead Field matrix that can be re-used for later computations (technically
                     saved as double precision).
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     The <B><I><A HREF="files-formats-cartool.html#ris">.ris</A></I></B> file also
                     contains a copy of the Lead Field, which can be used both for display
                     and for later reloading (saved as single precision).
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     For <I>display purpose only</I>, the Lead Field matrix converted into an <B>
                         <I>
                             <A HREF="files-formats-cartool.html#sef">.sef</A>
                         </I>
                     </B>
                     file. It can be used to display as a map how each SP influences all electrodes.
                 </P>
                 <P>
                     It only holds the norm of the vectorial Lead Field, per SP, once transposed.
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     The <B><I><A HREF="files-formats-cartool.html#vrb">.vrb</A></I></B> verbose
                     file contains some detailed results from the optional <A HREF="#skull-from-mri">
                         radii
                         from skull computation
                     </A> (scalp and skull radii and thicknesses).
                 </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <H2>
             <A NAME="combining-sps-and-lf"></A>Solution Points and Lead Field cases
         </H2>
         <H5>
             <A HREF="#sps-and-lf-cases">
                 All combinations of Solution Points and
                 Lead Field cases
             </A><br><A HREF="#lead-field-interpol">Interpolating a Lead Field</A><br>
             <A HREF="#lead-field-downsamp">Downsampling a Lead Field</A><br>
             <A HREF="#neutralizing-sps">Neutralizing some solution points</A>
         </H5>
         <H3>
             <A NAME="sps-and-lf-cases"></A>All combinations of Solution Points and
             Lead Field cases
         </H3>
         <P>
             Cartool allows all possible combinations between <B>
                 computing /
                 loading Solution Points
             </B>, and <B>computing / loading Lead Field</B>.
             Here is a table to sort out all these cases and explain their
             meaning and consequences:
         </P>
         <P>
             &nbsp;
         </P>
         <UL>
             <P>
                 <TABLE WIDTH="90%" CELLPADDING="5" CELLSPACING="2" BORDER="1">
                     <TR>
                         <TD WIDTH="20%" VALIGN=TOP>
                             <CENTER>
                                 <P ALIGN=CENTER>
                                     Solution Points \ Lead Field
                         </TD>
                         <TD WIDTH="40%" VALIGN=TOP>
                             <P>
                                 <B>Cartool computing Lead Field</B>
                         </TD>
                         <TD WIDTH="40%" VALIGN=TOP>
                             <P>
                                 <B>Loading Lead Field</B>
                         </TD>
                     </TR>
                     <TR>
                         <TD WIDTH="20%" VALIGN=TOP>
                             <P>
                                 <B>Cartol computing</B><BR>
                                 <B>Solution Points</B>
                         </TD>
                         <TD BORDERCOLOR="YELLOW" WIDTH="40%" VALIGN=TOP>
                             <UL>
                                 <LI CLASS="mvd-P">
                                     <P>
                                         <A HREF="#SPs-extraction">Solution Points done Cartool way</A>
                                     </P>
                                 <LI CLASS="mvd-P">
                                     <P>
                                         <A HREF="#lead-field-comp-det">Lead Field done Cartool way</A>
                                     </P>
                             </UL>
                             <P>
                                 This is the standard way: Cartool is computing everything for you
                                 (isn't it nice?).
                         </TD>
                         <TD BORDERCOLOR="YELLOW" WIDTH="40%" VALIGN=TOP>
                             <UL>
                                 <LI CLASS="mvd-P">
                                     <P>
                                         <A HREF="#SPs-extraction">Solution Points done Cartool way</A>
                                     </P>
                                 <LI CLASS="mvd-P">
                                     <P>
                                         <B><A HREF="#lead-field-interpol">Lead Field is interpolated</A></B>
                                     </P>
                             </UL>
                             <P>
                                 User loads a pre-computed Lead Field, f.ex. from another toolbox, but
                                 let Cartool computes its own Solution Points.
                             </P>
                             <P>
                                 The Cartool Solution Points will <I>not</I> match the input Solution
                                 Points / Lead Field, so an <A HREF="#lead-field-interpol">interpolation</A>
                                 is needed.
                         </TD>
                     </TR>
                     <TR>
                         <TD WIDTH="20%" VALIGN=TOP>
                             <P>
                                 <B>Loading Solution Points</B><BR>
                                 <B>from file</B>
                         </TD>
                         <TD BORDERCOLOR="DARKSEAGREEN" WIDTH="40%" VALIGN=TOP>
                             <UL>
                                 <LI CLASS="mvd-P">
                                     <P>
                                         <A HREF="#loading-sps">Loading Solution Points file &quot;as is&quot;</A>
                                     </P>
                                 <LI CLASS="mvd-P">
                                     <P>
                                         <A HREF="#lead-field-comp-det">Lead Field done Cartool way</A>
                                     </P>
                             </UL>
                             <P>
                                 User forces the solution space locations, but then lets Cartool
                                 compute its own Lead Field.
                             </P>
                             <P>
                                 This is useful for the sake of comparing Lead Field from Cartool and
                                 from other models.
                             </P>
                             <P>
                                 See these remarks about <A HREF="#loading-sps">
                                     what conditions the
                                     input points should fulfill
                                 </A>.
                         </TD>
                         <TD BORDERCOLOR="DARKSEAGREEN" WIDTH="40%" VALIGN=TOP>
                             <UL>
                                 <LI CLASS="mvd-P">
                                     <P>
                                         <A HREF="#loading-sps">Loading Solution Points file &quot;as is&quot;</A>
                                     </P>
                                 <LI CLASS="mvd-P">
                                     <P>
                                         <B><A HREF="#lead-field-interpol">Lead Field is interpolated</A></B>
                                     </P>
                             </UL>
                             <P>
                                 User forces the solution space locations, while also loading a Lead
                                 Field with another solution space.
                             </P>
                             <P>
                                 This is useful to switch from an existing solution space to another
                                 one, which allows comparing a solution space across different Lead Fields.
                             </P>
                             <P>
                                 It is important that the <A HREF="#lead-field-interpol">
                                     interpolated
                                     solution space encompasses / includes the targetted solution space
                                 </A>,
                                 so that an interpolation can be actually computed.
                             </P>
                             <P>
                                 See these remarks about <A HREF="#loading-sps">
                                     what conditions the
                                     input points should fulfill
                                 </A>.
                         </TD>
                     </TR>
                     <TR>
                         <TD WIDTH="20%" VALIGN=TOP>
                             <P>
                                 <B>Same Solution Points</B><BR>
                                 <B>as reloaded Lead Field</B>
                         </TD>
                         <TD BORDERCOLOR="ROYALBLUE" WIDTH="40%" VALIGN=TOP>
                             <UL>
                                 <LI CLASS="mvd-P">
                                     <P>
                                         <A HREF="#same-sp-as-lf">Solution Points file is </A><B><A HREF="#same-sp-as-lf">downsampled</A></B>
                                     </P>
                                 <LI CLASS="mvd-P">
                                     <P>
                                         <A HREF="#lead-field-comp-det">Lead Field done Cartool way</A>
                                     </P>
                             </UL>
                             <P>
                                 User reloads a Lead Field and its associated solution space, but
                                 Cartool will only use the given Solution Points and compute its own
                                 Lead Field.
                             </P>
                             <P>
                                 If the loaded solution space happen to be too big (above 8000
                                 points), then this solution space will be downsampled.
                         </TD>
                         <TD BORDERCOLOR="ROYALBLUE" WIDTH="40%" VALIGN=TOP>
                             <UL>
                                 <LI CLASS="mvd-P">
                                     <P>
                                         <A HREF="#same-sp-as-lf">Solution Points file is </A><B><A HREF="#same-sp-as-lf">downsampled</A></B>
                                     </P>
                                 <LI CLASS="mvd-P">
                                     <P>
                                         <A HREF="#lead-field-downsamp">Lead Field is </A><B><A HREF="#lead-field-downsamp">downsampled</A></B>
                                     </P>
                             </UL>
                             <P>
                                 User reloads a Lead Field and its associated solution space.
                             </P>
                             <P>
                                 This is useful when the model has to be loaded &quot;as is&quot;, and
                                 only the final <A HREF="#inverse-solution">inversion step</A> is needed.
                             </P>
                             <P>
                                 If the loaded solution space happen to be too big (above 8000
                                 points), then this solution space and Lead Field will be downsampled.
                         </TD>
                     </TR>
                 </TABLE>
             </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <P>
             Here are also the recommended scenarios, by decreasing order of
             results quality:
         </P>
         <OL>
             <LI CLASS="mvd-P">
                 <P>
                     Computing Solution Points + Computing Lead Field
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     Computing Solution Points + Loading &amp; Interpolating Lead Field
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     Loading Solution Points + Computing Lead Field
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     Loading Solution Points + Loading &amp; Interpolating Lead Field
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     Loading &amp; Downsampling Solution Points + Computing Lead Field
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     Loading &amp; Downsampling Solution Points + Loading &amp;
                     Downsampling Lead Field
                 </P>
         </OL>
         <P>
             &nbsp;
         </P>
         <H3>
             <A NAME="lead-field-interpol"></A>Interpolating a Lead Field
         </H3>
         <P>
             A Lead Field (in our case) is <B>
                 <A HREF="#lead-field-what-is">
                     discrete
                     vectorial field
                 </A>
             </B>. As such we are entitled to interpolate from
             the known positions &amp; values to get the vectorial values at <I>
                 other
                 positions
             </I>, allowing us to switch to different solution space <I>distributions</I>.
         </P>
         <P>
             There is a strong constraint however: the <B>
                 new targetted solution
                 space should be entirely contained within the source solution space
             </B>.
             This is the only way to correctly <I>interpolate</I> from known
             values, as otherwise we would <I>extrapolate</I> them, which is quite
             a risky move for a Lead Field.
         </P>
         <P>
             Interpolation of the vectorial field is currently tri-linear, hence
             each target position should have all of the 8 surrounding cube's
             neighbors around it.
         </P>
         <P>
             Since Cartool tries to be nice with you, points that are not within
             the input solution space will be kept but <A HREF="#neutralizing-sps">
                 neutralized
                 for all forthcoming calculations
             </A>.
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             See here is a correct example of a target solution space, where all
             points fit well within the original space:
         </P>
         <UL>
             <P>
                 <IMG SRC="images/cris.sp-interpolation-good.png" VSPACE="0" HSPACE="0" BORDER="0">
             </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <P>
             And here is a bad example, where some of the targetted points lie
             outside the original space, and will be <A HREF="#neutralizing-sps">neutralized</A>:
         </P>
         <UL>
             <P>
                 <IMG SRC="images/cris.sp-interpolation-bad.png" VSPACE="0" HSPACE="0" BORDER="0">
             </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <H3>
             <A NAME="lead-field-downsamp"></A>Downsampling a Lead Field
         </H3>
         <P>
             When the loaded solution space appear to be too dense for the
             inversion in Cartool, the recommended step is to simply <B>downsample it</B>.
         </P>
         <P>
             See here an example of (some heavy) downsampling:
         </P>
         <UL>
             <P>
                 <IMG SRC="images/cris.sp-downsampling.png" VSPACE="0" HSPACE="0" BORDER="0">
             </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <H3>
             <A NAME="neutralizing-sps"></A>Neutralizing some solution points
         </H3>
         <P>
             Some solution points might happen to be <I>
                 unfit at some stages of
                 the inversion
             </I>, for various reasons. Should this happen, these
             points will be &quot;neutralized&quot; for the remaining calculations.
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             Here is a list of some possible reasons to neutralize some points:
         </P>
         <UL>
             <LI CLASS="mvd-P">
                 <P>
                     <B>Not enough neighbors</B> (8) for a proper interpolation, when <A HREF="#lead-field-interpol">
                         switching
                         from one solution space to another
                     </A>.
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     <B>Points without neighbors</B> in the LORETA and LAURA inversions.
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     Points with an associated <B>null Lead Field column</B>, when
                     re-loading a Lead Field with previously neutralized Solution Points.
                 </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <P>
             Neutralization is quite straightforward, and is all done internally
             in Cartool without the need of any user input:
         </P>
         <UL>
             <LI CLASS="mvd-P">
                 <P>
                     Points marked as to be neutralized are first <B>removed</B> from the
                     list of points;
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     Cartool will work internally with this restricted list of points,
                     proceeding with computing all things like <B>Lead Field</B> and <B>
                         inverse
                         matrices
                     </B>;
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     Finally, the points that have been removed are <B>inserted back</B>
                     into the list of points, and the corresponding <B>Lead Field columns</B>
                     and <B>inverse matrices rows</B> are subsequently filled with 0's.
                 </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <P>
             This way, the final results will fit exactly into the user's intended
             solution space, without the problematic points interfering with the
             sensitive computation parts.
         </P>
         <P>
             Currently, the user is not warned during the processing, even with
             the <A HREF="#dialog-piloting">Interactive mode</A>, but the <A HREF="#IS-results">
                 verbose
                 file
             </A> will list if any points that have been neutralized, and for
             which reason.
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             Example of neutralized SPs, being too much on the outer side and
             therefore lacking enough neighbors for a correct interpolation:
         </P>
         <UL>
             <P>
                 <IMG SRC="images/cris.sp-neutralized.png" VSPACE="0" HSPACE="0" BORDER="0">
             </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <H2>
             <A NAME="inverse-solution"></A>Matrix inversion
         </H2>
         <P>
             &nbsp;
         </P>
         <H5>
             <A HREF="#IS-inverse-step">The matrix inversion step</A><br>
             <A HREF="#IS-input">Matrix inversion input</A><br><A HREF="#IS-types">Types of inversions</A>
         </H5>
         <UL>
             <H5>
                 <A HREF="#IS-MN">MN</A><br><A HREF="#IS-WMN">WMN</A><br><A HREF="#IS-sDale">sDale</A><br>
                 <A HREF="#IS-sLORETA">sLORETA</A><br><A HREF="#IS-LORETA">LORETA</A><br>
                 <A HREF="#IS-LAURA">LAURA</A><br><A HREF="#IS-eLORETA">eLORETA</A>
             </H5>
         </UL>
         <H5>
             <A HREF="#IS-technical-points">Matrix inversion - Technical points</A>
         </H5>
         <UL>
             <H5>
                 <A HREF="#IS-regularization">Tikhonov regularization</A><br>
                 <A HREF="#IS-stack-matrices">Stack of inverse matrices</A><br>
                 <A HREF="#IS-neighborhood">Neighborhood connectivity</A>
             </H5>
         </UL>
         <H5>
             <A HREF="#IS-results">Matrix inversion results</A><br>
             <A HREF="#IS-final-words">Final words...</A>
         </H5>
         <P>
             &nbsp;
         </P>
         <H3>
             <A NAME="IS-inverse-step"></A>The matrix inversion step
         </H3>
         <P>
             This is the step where the <B>
                 <A HREF="#lead-field-what-is">
                     Lead
                     Field matrix
                 </A>
             </B>, which gives the relationship <I>
                 from Solution
                 Points to electrodes
             </I>, is <B>mathematically inverted</B>, hence giving the
             relationship <I>from electrodes to Solution Points</I>.
         </P>
         <P>
             All the theory and background you need to know are in these <A HREF="#theory">
                 <B>
                     books
                     and articles
                 </B>
             </A>. Yes, <U>read</U> them.
         </P>
         <P>
             &nbsp;
         </P>
         <H3>
             <A NAME="IS-input"></A>Matrix inversion input
         </H3>
         <P>
             Either possibilities:
         </P>
         <UL>
             <LI CLASS="mvd-P">
                 <P>
                     If you have <A HREF="#lead-field-comp-det">computed the LF</A>, the <A HREF="#lead-field-results">
                         output
                         files of this process
                     </A> are simply forwarded to the inversion
                     process, and you have nothing more to do.
                 </P>
                 <UL>
                     <P>
                         or
                     </P>
                 </UL>
             <LI CLASS="mvd-P">
                 <P>
                     If you have <A HREF="#lead-field-loading">reloaded an existing LF</A>,
                     you simply need <A HREF="#lead-field-inputfil">these files</A>.
                 </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <H3>
             <A NAME="IS-types"></A>Types of inversions
         </H3>
         <P>
             Cartool lets you choose which inverse model to use, non-exclusively,
             among the following ones. The specific math for each inverse is well
             explained in the articles cited below, and will not be replicated here.
         </P>
         <P>
             Note that we usually work with the LORETA or LAURA inverses most of the time.
         </P>
         <P>
             &nbsp;
         </P>
         <H4>
             <A NAME="IS-MN"></A>MN
         </H4>
         <P>
             The <B>Minimum Norm</B> inverse is the corner-stone of many other inverses,
             which are based on top of it. It is available for the sake of benchmarks and
             comparisions.
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             One reference among others, with pointers to more literature, is:
         </P><PRE><strong>&quot;Interpreting Magnetic Fields of the Brain Minimum Norm Estimates&quot;,
M. S. </strong>H&auml;m&auml;l&auml;inen, R. J. Ilmoniemi,
<em>Med. &amp; Biol. Eng. Comput.</em>,  1994</PRE>
         <H4>
             <A NAME="IS-WMN"></A>WMN
         </H4>
         <P>
             The <B>Weighted Minimum Norm</B> is an improvement to the simple Minimum Norm
             above. It works by weighting the inverse results according to the depth of
             each solution points, deeper sources being given greater weights. LORETA and
             LAURA are also both based on it.
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             You can find some resources for the <B>WMN</B> inverse here:
         </P><PRE><B>&quot;Review of Methods for Solving the EEG Inverse Problem&quot;</B>,<BR>Roberto Domingo Pascual-Marqui,<BR><I>International Journal of Bioelectromagnetism</I>, 1999, Vol. 1 N&#176; 1.<BR> <BR> <BR><B>&quot;Electrical neuroimaging base on biophysical constraints&quot;</B>,<BR>Rolando Grave de Peralta Menendez, Micah M. Murray, Christoph M. Michel, Roberto Martuzzi, Sara L. Gonzalez Andino,<BR><I>NeuroImage</I>, 2003.<BR> <BR> <BR>http://www.uzh.ch/keyinst/NewLORETA/SomePapers/LORETAcve/01-Reply.htm</PRE>
         <H4>
             <A NAME="IS-sDale"></A>sDale
         </H4>
         <P>
             This is one interpretation of the Dale way of correcting the Minimum Norm
             results. It uses the diagonal of the covariance matrix of the sensors to
             &quot;recalibrate&quot; the estimated dipoles. The Cartool version is <strong>
                 one
                 possible implementation
             </strong>, the one explained in the sLORETA paper
             (hence the name sDale given here). <em>
                 Another version is the dSPM
                 implementation
             </em>, which uses a direct estimate of the covariance <em>
                 from
                 the data
             </em>. So sDale and dSPM are rather siblings than twins!
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             Here are some references:
         </P><PRE><strong>&quot;Improved localization of cortical activity by combining EEG and MEG with MRI cortical surface reconstruction A linear approach&quot;,
</strong>Dale Sereno,
<em>J. of Cogn. Neurosc.</em>, 1993


<strong>&quot;Dynamic statistical parametric neurotechnitque mapping Combining fMRI and MEG for high-resolution imaging of cortical activity&quot;,
</strong>Dale, Liu, Fischl, Buckner, Belliveau, Lewin, Halgren,
<em>Neuron</em>, 2000


<strong>&quot;Standardized low resolution brain electromagnetic tomography (sLORETA): technical details&quot;,
</strong>R.D. Pascaul-Marqui,
<em>Methods &amp; Findings in Experimental &amp; Clinical Pharmacology</em>, 2002</PRE>
         <H4>
             <A NAME="IS-sLORETA"></A>sLORETA
         </H4>
         <P>
             This version of the Minimum Norm adds a final standardization step estimated
             from the noise, an approach very close to the one of <A HREF="#IS-sDale">Dale</A>.
             Also note that it has nothing in common with LORETA, apart from being based
             on the MN and its author personnal interest in this very name...
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             The original paper about sLORETA:
         </P><PRE><strong>&quot;Standardized low resolution brain electromagnetic tomography (sLORETA): technical details&quot;,
</strong>R.D. Pascaul-Marqui,
<em>Methods &amp; Findings in Experimental &amp; Clinical Pharmacology</em>, 2002</PRE>
         <H4>
             <A NAME="IS-LORETA"></A>LORETA
         </H4>
         <P>
             <B>LORETA</B> is based on the WMN inverse, and adds a Laplacian to ensure
             some local smoothness in the inverse. Somehow, this also seems to make it the
             most robust to noise. A quite good and general purpose inverse!
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             You can find some resources for the <B>LORETA</B> inverse here:
         </P><PRE><B>Electrical Neuroimaging</B>,<BR>Chr. Michel, Th. Koenig, D. Brandeis, L.R.R. Gianotti and J. Wackermann,<BR><I>Cambridge University Press</I>, 2009.<BR> <BR> <BR><B>Review of Methods for Solving the EEG Inverse Problem</B>,<BR>Roberto Domingo Pascual-Marqui,<BR><I>International Journal of Bioelectromagnetism</I>, 1999, Vol. 1, N&#176; 1.<BR> <BR> <BR><B>Electrical neuroimaging base on biophysical constraints</B>,<BR>Rolando Grave de Peralta Menendez, Micah M. Murray, Christoph M. Michel, Roberto Martuzzi, Sara L. Gonzalez Andino,<BR><I>NeuroImage</I>, 2003.<BR> <BR> <BR>http://www.uzh.ch/keyinst/NewLORETA/SomePapers/LORETAcve/01-Reply.htm</PRE>
         <H4>
             <A NAME="IS-LAURA"></A>LAURA
         </H4>
         <P>
             The <B>LAURA</B> inverse is also based on the WMN inverse, and is very close to the <B>LORETA</B>
             inverse. It replaces the Laplacian used for smoothness with another local
             auto-regressive operator (plus, it sounds impressive). Results are also quite
             robust to noise.
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             You can find some resources for the <B>LAURA</B> inverse here:
         </P><PRE><B>Electrical Neuroimaging</B>,<BR>Chr. Michel, Th. Koenig, D. Brandeis, L.R.R. Gianotti and J. Wackermann,<BR><I>Cambridge University Press</I>, 2009.<BR> <BR> <BR><B>Electrical neuroimaging base on biophysical constraints</B>,<BR>Rolando Grave de Peralta Menendez, Micah M. Murray, Christoph M. Michel, Roberto Martuzzi, Sara L. Gonzalez Andino,<BR><I>NeuroImage</I>, 2003.<BR> <BR> <BR><B>Comparison of Algorithms for the Localization of Focal Sources: Evaluation with simulated data</B><BR><B>and analysis of experimental data</B>,<BR>Rolando Grave de Peralta Menendez, Sara L. Gonzalez Andino,<BR><I>International Journal of Bioelectromagnetism</I>, 2002, Vol., 4 N&#176; 1.</PRE>
         <H4>
             <A NAME="IS-eLORETA"></A>eLORETA
         </H4>
         <P>
             The latest avatar of the LORETA family, still based on MN inverse. It has the
             very nice property of an exact localization for <strong>
                 1 single dipole and
                 <em>no</em> noise
             </strong>. However it degrades pretty fast for even small
             amount of noise (10%), and also if more than one source is present. Still an
             interesting inverse to have. And again, it has nothing to do with the
             historically first LORETA inverse, and neither with sLORETA... Think about
             other names at one point, maybe?
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             eLORETA original description is only available as a non-peer reviewed
             technical paper, here:
         </P><PRE><strong>&quot;Discrete, 3D distributed linear imaging methods of electric neuronal activity. Part 1: exact, zero error localization&quot;,
</strong>Pascual-Marqui,
<em>Technical Report</em>, arXiv 2007</PRE>
         <P>
             &nbsp;
         </P>
         <H3>
             <A NAME="IS-technical-points"></A>Matrix inversion - Technical points
         </H3>
         <H4>
             <A NAME="IS-regularization"></A>Tikhonov regularization
         </H4>
         <P>
             Some <B>regularization</B> has to be used if there is any sort of <B>
                 noise
                 in the data
             </B>, which is always the case with real-life data:
         </P>
         <UL>
             <P>
                 <IMG SRC="images/symbol.regularization-formula.png" VSPACE="0" HSPACE="0" BORDER="0">
             </P>
             <P>
                 (with <I>K</I> being the Lead Field, <I>W</I> the specific weights of
                 the inverse, <IMG SRC="images/symbol.alpha.png" VSPACE="0" HSPACE="0" BORDER="0">
                 the regularization factor, <I>J</I> the current source density, <IMG SRC="images/symbol.phi.png" VSPACE="0" HSPACE="0" BORDER="0">
                 the surface potential)
             </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <P>
             One problem arises from the fact that the regularization factor <IMG SRC="images/symbol.alpha.png" VSPACE="0" HSPACE="0" BORDER="0">
             depends on:
         </P>
         <UL>
             <LI CLASS="mvd-P">
                 <P>
                     The <B>type of inverse</B> (LORETA, LAURA, etc...)
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     The <B>noise level</B> of the data.
                 </P>
         </UL>
         <P>
             The latter is not always know in advance, and even so, we don't want
             to compute an inverse matrix that couldn't be used with other data sets!
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             The solution for Cartool is to compute a <B>set of matrices</B> with
             a <B>range of <IMG SRC="images/symbol.alpha.png" VSPACE="0" HSPACE="0" BORDER="0">'s</B>,
             from which the user can <A HREF="esi-display.html#regul-reset">
                 later
                 select
             </A>:
         </P>
         <UL>
             <LI CLASS="mvd-P">
                 <P>
                     For a given inverse model, first compute the constant <IMG SRC="images/symbol.alpha.png" VSPACE="0" HSPACE="0" BORDER="0"><SUB><I>Eigen</I></SUB>
                 </P>
                 <P>
                     <IMG SRC="images/symbol.alpha-eigen.png" VSPACE="0" HSPACE="0" BORDER="0">
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     Then for <I>i</I>=0 to 12, use the following regularization factors <IMG SRC="images/symbol.alpha.png" VSPACE="0" HSPACE="0" BORDER="0"><SUB>i</SUB>
                 </P>
                 <P>
                     <IMG SRC="images/symbol.alpha-eigen-i.png" VSPACE="0" HSPACE="0" BORDER="0">
                 </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <P>
             You end up with <B>13 matrices</B> (for each type of inverse, of
             course), the first one without regularization, and the following 12
             ones with linearly increasing levels of regularization.
         </P>
         <P>
             &nbsp;
         </P>
         <H4>
             <A NAME="IS-stack-matrices"></A>Stack of inverse matrices
         </H4>
         <P>
             Linked to the <A HREF="#IS-regularization">point above</A>, we
             currently output <B>13 matrices per inverse type</B> (LORETA, LAURA,
             etc...). However, this could be rather clumsy and error prone to
             manipulate as separate files.
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             To ease a bit your life, Cartool has upgraded the <B><I><A HREF="files-formats-cartool.html#is">.is</A></I></B>
             format so as to be able to pack a <B>set of matrices</B> into a <B>
                 single
                 file
             </B>. This &quot;super-matrix&quot; offers the following advantages:
         </P>
         <UL>
             <LI CLASS="mvd-P">
                 <P>
                     <B>easier to copy/delete/drop</B>,
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     <B>no regularization can be lost</B> by itself,
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     all the regularizations can be browsed at once, f.ex. for an
                     automated <B>
                         <A HREF="esi-display.html#menu-regularization">
                             search
                             of an optimal regularization
                         </A>
                     </B>.
                 </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <H4>
             <A NAME="IS-neighborhood"></A>Neighborhood connectivity
         </H4>
         <P>
             Within the Cartool implementation, both LORETA and LAURA inverses use <B>
                 an
                 average of 18 neighbors
             </B>, needed to compute the Laplacian (f.ex.).
         </P>
         <P>
             For each Solution Point, voxels from the <B>
                 <A HREF="https://en.wikipedia.org/wiki/Pixel_connectivity#3-dimensional">
                     18
                     neighbors
                 </A>
             </B> are first taken, and if there aren't enough of
             them, then the <B>26 neighbors</B>. This way, all the Solution Points
             are closer to 18 neighbors in average.
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             The <A HREF="#IS-results">results of inverse</A> section provides
             some details about the resulting neighborhood: the connectivity
             between SPs, and the actual density of neighbors per SP.
         </P>
         <P>
             &nbsp;
         </P>
         <H3>
             <A NAME="IS-results"></A>Matrix inversion results
         </H3>
         <P>
             These are the final results for the Inverse Solutions:
         </P>
         <UL>
             <LI CLASS="mvd-P">
                 <P>
                     The much desired&nbsp; <I><B><A HREF="files-formats-cartool.html#is">.is</A></B></I>&nbsp;
                     Inverse matrix file(s) (see <A HREF="#IS-stack-matrices">this note</A>).
                 </P>
             <LI CLASS="mvd-P">
                 <P>
                     The <B><I><A HREF="files-formats-cartool.html#vrb">.vrb</A></I></B> verbose
                     file contains some detailed results, like statistics about neighborhood.
                 </P>
         </UL>
         <P>
             &nbsp;
         </P>
         <H3>
             <A NAME="IS-final-words"></A>Final words...
         </H3>
         <P>
             You can now use your shiny new inverse matrices for some <A HREF="esi-display.html">
                 <B>
                     interactive
                     display
                 </B>
             </A>, or to perform the last step by <strong>
                 <a href="computing-ris.html">
                     multiplying them by
                     the EEG
                 </a>
             </strong>.
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             &nbsp;
         </P>
         <P>
             &nbsp;
     </div>
 </BODY>
</HTML>